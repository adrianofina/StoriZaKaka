{% extends "base/base.html" %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Login" %}{% endblock %}

{% block content %}
<div class="auth-container">
    <!-- Header with Logo -->
    <div class="auth-header">
        <img src="{% static 'img/your-logo.svg' %}" alt="MoviePicker" class="auth-logo">
        <h1>{% trans "Welcome Back" %}</h1>
        <p class="auth-subtitle">{% trans "Sign in to access your personalized recommendations" %}</p>
    </div>

    <!-- Login Form -->
    <form method="post" action="{% url 'account_login' %}" class="auth-form" id="loginForm">
        {% csrf_token %}
        
        <!-- Error Messages -->
        {% if form.errors %}
        <div class="alert alert-error">
            <i class="fas fa-exclamation-circle"></i>
            {% trans "Invalid email or password" %}
        </div>
        {% endif %}

        <!-- Email Field -->
        <div class="form-group">
            <label for="id_login">{% trans "Email" %}</label>
            <div class="input-with-icon">
                <i class="fas fa-envelope"></i>
                <input type="email" name="login" id="id_login" 
                       placeholder="{% trans 'your@email.com' %}" required autofocus>
            </div>
        </div>

        <!-- Password Field -->
        <div class="form-group">
            <label for="id_password">{% trans "Password" %}</label>
            <div class="input-with-icon">
                <i class="fas fa-lock"></i>
                <input type="password" name="password" id="id_password" 
                       placeholder="{% trans 'Your password' %}" required>
                <button type="button" class="toggle-password" aria-label="{% trans 'Show password' %}">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            <a href="{% url 'account_reset_password' %}" class="forgot-password">
                {% trans "Forgot password?" %}
            </a>
        </div>

        <!-- Remember Me -->
        <div class="form-group remember-me">
            <input type="checkbox" name="remember" id="id_remember">
            <label for="id_remember">{% trans "Keep me signed in" %}</label>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary btn-block">
            <span class="btn-loading" hidden></span>
            <span class="btn-text">{% trans "Sign In" %}</span>
        </button>
    </form>

    <!-- Social Login Divider -->
    <div class="social-divider">
        <span>{% trans "or continue with" %}</span>
    </div>

    <!-- Google Login -->
    <a href="{% url 'social:begin' 'google-oauth2' %}?next={{ request.GET.next }}" 
       class="btn btn-social btn-google">
        <img src="{% static 'img/google-logo.svg' %}" alt="Google" class="social-logo">
        {% trans "Google" %}
    </a>

    <!-- Registration Prompt -->
    <div class="auth-footer">
        {% trans "Don't have an account?" %}
        <a href="{% url 'account_signup' %}">{% trans "Create account" %}</a>
    </div>
</div>

<!-- Loading Animation -->
<div class="auth-loading" hidden>
    <div class="loading-spinner"></div>
    <p>{% trans "Signing you in..." %}</p>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* Base Theme Integration */
.auth-container {
    max-width: 420px;
    margin: 2rem auto;
    padding: 2rem;
    background: var(--card-bg);
    border-radius: 12px;
    box-shadow: var(--shadow-md);
}

.auth-header {
    text-align: center;
    margin-bottom: 2rem;
}

.auth-logo {
    height: 48px;
    margin-bottom: 1rem;
}

.auth-subtitle {
    color: var(--text-secondary);
    margin-top: 0.5rem;
}

/* Form Styles */
.input-with-icon {
    position: relative;
}

.input-with-icon i {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-tertiary);
}

.input-with-icon input {
    padding-left: 40px !important;
}

.toggle-password {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--text-tertiary);
    cursor: pointer;
}

/* Social Login */
.btn-social {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: 100%;
    padding: 0.75rem;
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.2s;
}

.btn-google {
    background: white;
    color: #5F6368;
    border: 1px solid #DADCE0;
}

.btn-google:hover {
    background: #F8F9FA;
    border-color: #D2E3FC;
}

.social-logo {
    height: 20px;
}

.social-divider {
    display: flex;
    align-items: center;
    margin: 1.5rem 0;
    color: var(--text-tertiary);
}

.social-divider::before,
.social-divider::after {
    content: "";
    flex: 1;
    border-bottom: 1px solid var(--border-color);
}

.social-divider span {
    padding: 0 1rem;
}

/* Responsive */
@media (max-width: 480px) {
    .auth-container {
        margin: 1rem;
        padding: 1.5rem;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Password visibility toggle
    document.querySelectorAll('.toggle-password').forEach(btn => {
        btn.addEventListener('click', function() {
            const input = this.closest('.input-with-icon').querySelector('input');
            const isPassword = input.type === 'password';
            input.type = isPassword ? 'text' : 'password';
            this.innerHTML = isPassword ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
        });
    });

    // Form submission handler
    const form = document.getElementById('loginForm');
    form.addEventListener('submit', function(e) {
        const submitBtn = this.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.querySelector('.btn-text').hidden = true;
        submitBtn.querySelector('.btn-loading').hidden = false;
        
        document.querySelector('.auth-loading').hidden = false;
    });
});
</script>
{% endblock %}