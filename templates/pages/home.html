<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KakaFlix</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@800&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/home.css">
    
</head>
<body data-theme="dark" data-lang="en">
    <!-- Majestic Floating Gradient Bubbles -->
    <div class="bubble-container">
        <div class="bubble bubble-1"></div>
        <div class="bubble bubble-2"></div>
        <div class="bubble bubble-3"></div>
        <div class="bubble bubble-4"></div>
        <div class="bubble bubble-5"></div>
        <div class="bubble bubble-6"></div>
        <div class="bubble bubble-7"></div>
    </div>
    
    <!-- Scroll Progress Bar -->
    <div class="scroll-progress" id="scrollProgress"></div>

    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <div class="logo">
                <span class="logo-icon">üé¨</span>
                <span>Stori za Kaka</span>
            </div>
            <ul class="nav-center">
                <li><a href="#home" data-en="Home" data-sw="Nyumbani">Home</a></li>
                <li><a href="#features" data-en="Features" data-sw="Vipengele">Features</a></li>
                <li><a href="#showcase" data-en="Showcase" data-sw="Maonesho">Showcase</a></li>
                <li><a href="#discover" data-en="Discover" data-sw="Gundua">Discover</a></li>
                <li><a href="#contact" data-en="Contact" data-sw="Mawasiliano">Contact</a></li>
            </ul>
            <div class="nav-controls">
                <!-- Refresh Button in Nav -->
                <button class="hero-refresh" id="heroRefreshBtn" aria-label="Refresh hero content" tabindex="0" data-tooltip="Refresh Movie content">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="theme-toggle" id="themeToggle" title="Toggle theme">
                    <span class="theme-icon">üåô</span>
                </button>
                <button class="language-toggle" id="languageToggle">
                    <span data-en="SW" data-sw="EN">SW</span>
                </button>
            </div>
        </nav>
    </header>

    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Open menu">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Enhanced Mobile Menu Panel -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="menu-header">
            <div class="menu-time-container">
                <i class="fas fa-clock"></i>
                <span id="menu-time">14:30</span>
            </div>
            <button class="close-menu" id="closeMenuBtn" aria-label="Close menu">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <nav class="vertical-nav">
            <a href="#home" class="menu-item" aria-label="Go to Home section">
                <i class="fas fa-home"></i>
                <span data-en="Home" data-sw="Nyumbani">Home</span>
            </a>
            <a href="#showcase" class="menu-item" aria-label="Go to Showcase section">
                <i class="fas fa-film"></i>
                <span data-en="Showcase" data-sw="Maonesho">Showcase</span>
            </a>
            <a href="#discover" class="menu-item" aria-label="Go to Discover section">
                <i class="fas fa-search"></i>
                <span data-en="Discover" data-sw="Gundua">Discover</span>
            </a>
            <a href="#features" class="menu-item" aria-label="Go to Features section">
                <i class="fas fa-star"></i>
                <span data-en="Features" data-sw="Vipengele">Features</span>
            </a>
            <a href="#contact" class="menu-item" aria-label="Go to Contact section">
                <i class="fas fa-envelope"></i>
                <span data-en="Contact" data-sw="Mawasiliano">Contact</span>
            </a>
            
            <!-- Additional menu items -->
            <div class="menu-divider"></div>
            
            <a href="#about" class="menu-item" aria-label="Go to About section">
                <i class="fas fa-info-circle"></i>
                <span data-en="About" data-sw="Kuhusu">About</span>
            </a>
            <a href="#help" class="menu-item" aria-label="Go to Help section">
                <i class="fas fa-question-circle"></i>
                <span data-en="Help" data-sw="Msaada">Help</span>
            </a>
            <a href="#settings" class="menu-item" aria-label="Go to Settings">
                <i class="fas fa-cog"></i>
                <span data-en="Settings" data-sw="Mipangilio">Settings</span>
            </a>
        </nav>
        
        <!-- Menu footer -->
        <div class="menu-footer">
            <div class="menu-version">
                <span data-en="Version" data-sw="Toleo">Version</span>
                <span>1.0.0</span>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="hero-bg-slider"></div>
        <!-- Navigation Arrows -->
        <button class="hero-arrow hero-arrow-left" id="heroArrowLeft" aria-label="Previous" tabindex="0">
            <i class="fas fa-chevron-left"></i>
        </button>
        <button class="hero-arrow hero-arrow-right" id="heroArrowRight" aria-label="Next" tabindex="0">
            <i class="fas fa-chevron-right"></i>
        </button>
        <!-- Dynamic Movie Overlay -->
        <div class="hero-overlay" id="heroOverlay"></div>
        
        <!-- Mobile Details Button -->
        <button class="mobile-details-btn" id="mobileDetailsBtn" data-en="View Details" data-sw="Ona Maelezo">
            <i class="fas fa-info-circle"></i>
            <span data-en="View Details" data-sw="Ona Maelezo">This movie</span>
        </button>
        
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title" id="heroHeadline" data-en="Stori za Kaka here‚Äîyour movie matchmaker." data-sw="Hujambo! Stori za Kaka hapa‚Äîmchumba wako wa filamu.">Stori za Kaka here‚Äîyour movie matchmaker.</h1>
                <p class="hero-subtitle" id="heroSubtext"
                   data-en="Can't decide what to watch? Just tell me your mood, and I'll handpick a film you'll love. Ready to discover your next favorite movie together?"
                   data-sw="Hauwezi kuamua uangalie nini? Niambie tu hali yako, nitakuchagulia filamu utakayopenda. Tuko tayari kugundua filamu yako mpya unayopenda pamoja?">
                    Can't decide what to watch? Just tell me your mood, and I'll handpick a film you'll love. Ready to discover your next favorite movie together?
                </p>
                <br>
                <div class="hero-actions">
                    <a href="#discover" class="btn btn-primary" data-en="Find My Movie" data-sw="Tafuta Filamu Yangu">
                        <i class="fas fa-play"></i> Find My Movie
                        <i class="fas fa-arrow-right pulse-arrow"></i>
                    </a>
                    <a href="#showcase" class="btn btn-secondary" data-en="Browse Movies" data-sw="Vinjari Filamu">
                        <i class="fas fa-film"></i> Browse Movies
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Enhanced Movie Modal System -->
    <div class="movie-modal" id="movieModal">
        <!-- Dynamic Blurred Backdrop -->
        <div class="modal-backdrop" id="modalBackdrop"></div>
        
        <!-- Modal Container -->
        <div class="modal-container">
        <button class="modal-close" id="modalClose">‚úï</button>
        
        <!-- Modal Navigation Arrows -->
        <button class="modal-arrow modal-arrow-left" id="modalArrowLeft" aria-label="Previous movie">
            <i class="fas fa-chevron-left"></i>
        </button>
        <button class="modal-arrow modal-arrow-right" id="modalArrowRight" aria-label="Next movie">
            <i class="fas fa-chevron-right"></i>
        </button>
        
        <div class="modal-poster" id="modalPoster">
            <!-- Movie poster will be inserted here -->
        </div>
        
        <div class="modal-content">
            <h3 id="modalTitle">Movie Title</h3>
            <div class="modal-meta" id="modalMeta">
                <span class="modal-rating">‚≠ê 8.5</span>
                <span class="modal-year">2023</span>
                <span class="modal-genre">Action</span>
            </div>
            <p class="modal-desc" id="modalDesc">
                Movie description will be inserted here...
            </p>
            <button class="watch-trailer" id="watchTrailer" data-yt-id="">
                <i class="fas fa-play"></i> ‚ñ∂ Play Trailer
            </button>
            </div>
        </div>
    </div>

    <!-- YouTube Container -->
    <div class="youtube-container" id="youtubeContainer">
        <button class="youtube-close" id="youtubeClose">‚úï</button>
        <!-- YouTube iframe will be inserted here -->
    </div>

    <!-- Features Section -->
    <section class="section" id="features">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title" data-en="Why Choose Stori za Kaka?" data-sw="Kwa Nini Kuchagua Stori za Kaka?">Why Choose Stori za Kaka?</h2>
                <p class="section-subtitle"
                   data-en="Our unique approach to movie recommendations sets us apart from traditional platforms"
                   data-sw="Mbinu yetu ya kipekee ya mapendekezo ya filamu inatufanya tuwe tofauti na majukwaa ya kawaida">
                    Our unique approach to movie recommendations sets us apart from traditional platforms
                </p>
            </div>
            
            <div class="features-grid">
                <div class="feature-card">
                    <span class="feature-icon">üß†</span>
                    <h3 class="feature-title" data-en="Mood Recognition" data-sw="Utambuzi wa Hali">Mood Recognition</h3>
                    <p class="feature-description"
                       data-en="Our AI detects subtle emotional cues from your interactions to suggest movies that match your current state of mind."
                       data-sw="AI yetu hugundua ishara za kihisia kutoka kwa mwingiliano wako kupendekeza filamu zinazolingana na hali yako ya sasa ya akili.">
                        Our -- detects subtle emotional cues from your interactions to suggest movies that match your current state of mind.
                    </p>
                </div>
                
                <div class="feature-card">
                    <span class="feature-icon">üéØ</span>
                    <h3 class="feature-title" data-en="Precision Matching" data-sw="Ulinganifu Sahihi">Precision Matching</h3>
                    <p class="feature-description"
                       data-en="We analyze thousands of data points to find films with the perfect combination of themes, pacing, and emotional impact for you."
                       data-sw="Tunachambua maelfu ya data kupata filamu zenye mchanganyiko kamili wa mada, mwendo, na athari za kihisia kwako.">
                        We analyze thousands of data points to find films with the perfect combination of themes, pacing, and emotional impact for you.
                    </p>
                </div>
                
                <div class="feature-card">
                    <span class="feature-icon">üåç</span>
                    <h3 class="feature-title" data-en="Global Cinema" data-sw="Sinema ya Kimataifa">Global Cinema</h3>
                    <p class="feature-description"
                       data-en="From Hollywood blockbusters to Tanzanian gems and international arthouse films, we celebrate diverse cinematic voices."
                       data-sw="Kutoka kwa filamu kubwa za Hollywood hadi vito vya Kitanzania na filamu za kimataifa za sanaa, tunasisitiza sauti mbalimbali za sinema.">
                        From Hollywood blockbusters to Tanzanian gems and international arthouse films, we celebrate diverse cinematic voices.
                    </p>
                </div>
                
                <div class="feature-card">
                    <span class="feature-icon">üîÑ</span>
                    <h3 class="feature-title" data-en="Adaptive Learning" data-sw="Kujifunza Kukabiliana">Adaptive Learning</h3>
                    <p class="feature-description"
                       data-en="The more you use Stori za Kaka, the better it understands your evolving tastes and preferences over time."
                       data-sw="Kadiri unavyotumia Stori za Kaka, ndivyo inavyoelewa vyema ladha na mapendeleo yako yanayobadilika kwa muda.">
                        The more you use Stori za Kaka, the better it understands your evolving tastes and preferences over time.
                    </p>
                </div>
                
                <div class="feature-card">
                    <span class="feature-icon">üé≠</span>
                    <h3 class="feature-title" data-en="Character Analysis" data-sw="Uchambuzi wa Wahusika">Character Analysis</h3>
                    <p class="feature-description"
                       data-en="We match you with films based on the personality types of characters you've connected with in the past."
                       data-sw="Tunakufananisha na filamu kulingana na aina za tabia za wahusika ambao umeshirikiana nao hapo awali.">
                        We match you with films based on the personality types of characters you've connected with in the past.
                    </p>
                </div>
                
                <div class="feature-card">
                    <span class="feature-icon">üìä</span>
                    <h3 class="feature-title" data-en="Cultural Context" data-sw="Muktadha wa Kitamaduni">Cultural Context</h3>
                    <p class="feature-description"
                       data-en="Our recommendations consider cultural relevance, ensuring films resonate with your background and experiences."
                       data-sw="Mapendekezo yetu yanazingatia umuhimu wa kitamaduni, kuhakikisha filamu zinahusiana na asili yako na uzoefu wako.">
                        Our recommendations consider cultural relevance, ensuring films resonate with your background and experiences.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Movie Showcase Section -->
    <section class="section" id="showcase">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title" data-en="Featured Movies" data-sw="Filamu Maalum">Featured Movies</h2>
                <p class="section-subtitle"
                   data-en="A selection of popular and critically acclaimed films from our collection"
                   data-sw="Uteuzi wa filamu maarufu na zilizosifiwa kutoka kwenye mkusanyiko wetu">
                    A selection of popular and critically acclaimed films from our collection
                </p>
            </div>
            <div class="movie-showcase" id="featuredMovies">
                <!-- Glassmorphic Search Bar -->
                <form class="sticky-search-bar" id="mainSearchBar" role="search" autocomplete="off" aria-label="Movie search">
                    <input type="text" id="featuredSearchInput" class="search-input" placeholder="Search movies..." aria-label="Search movies" />
                    <button type="submit" class="search-btn" aria-label="Search">
                        <i class="fa fa-search"></i>
                    </button>
                </form>
                
                <!-- Redesigned Showcase Section -->
                <section class="showcase">
                    <!-- Movies Row -->
                    <div class="showcase-header">
                        <h2 class="section-title" data-en="Trending Movies" data-sw="Filamu Maarufu">Trending Movies</h2>
                        <div class="carousel-controls">
                            <button class="nav-arrow prev" id="moviesPrevArrow" aria-label="Previous movies">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="nav-arrow next" id="moviesNextArrow" aria-label="Next movies">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="carousel-container" id="movies-carousel">
                        <div class="loading-indicator hidden" id="moviesLoading">
                            <div class="spinner"></div>
                        </div>
                    </div>

                    <!-- TV Shows Row -->
                    <div class="showcase-header">
                        <h2 class="section-title" data-en="Trending TV Shows" data-sw="Vipindi Maarufu">Trending TV Shows</h2>
                        <div class="carousel-controls">
                            <button class="nav-arrow prev" id="tvPrevArrow" aria-label="Previous shows">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="nav-arrow next" id="tvNextArrow" aria-label="Next shows">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="carousel-container" id="tv-carousel">
                        <div class="loading-indicator hidden" id="tvLoading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </section>

    <!-- Discover Section - Enhanced -->
      <section class="section" id="discover">
        <div class="container">
            <div class="discover-section">
                <div class="discover-header">
                    <h2 class="discover-title" data-en="Discover Your Perfect Movie" data-sw="Gundua Filamu Yako Kamili">Discover Your Perfect Movie</h2>
                    <p class="discover-subtitle"
                       data-en="Answer a few questions about your current mood and preferences, and we'll find the ideal film for you"
                       data-sw="Jibu maswali machache kuhusu hali yako ya sasa na mapendeleo, na tutakupatia filamu bora kwako">
                        Answer a few questions about your current mood and preferences, and we'll find the ideal film for you
                    </p>
                </div>

                <div class="questionnaire-card">
                    <div class="question-container">
                        <!-- Question 1: Mood -->
                        <div class="question active" id="question1">
                            <h3><span class="emoji">üòä</span> <span data-en="How are you feeling right now?" data-sw="Unajisikiaje sasa hivi?">How are you feeling right now?</span></h3>
                            <div class="mood-options" data-question="currentMood">
                                <div class="mood-btn" data-value="happy">
                                    <span class="emoji">üòÑ</span>
                                    <span data-en="Happy" data-sw="Furaha">Happy</span>
                                </div>
                                <div class="mood-btn" data-value="sad">
                                    <span class="emoji">üò¢</span>
                                    <span data-en="Sad" data-sw="Huzuni">Sad</span>
                                </div>
                                <div class="mood-btn" data-value="excited">
                                    <span class="emoji">ü§©</span>
                                    <span data-en="Excited" data-sw="Msisimko">Excited</span>
                                </div>
                                <div class="mood-btn" data-value="calm">
                                    <span class="emoji">üòå</span>
                                    <span data-en="Calm" data-sw="Tulivu">Calm</span>
                                </div>
                                <div class="mood-btn" data-value="stressed">
                                    <span class="emoji">üò∞</span>
                                    <span data-en="Stressed" data-sw="Mkazo">Stressed</span>
                                </div>
                                <div class="mood-btn" data-value="romantic">
                                    <span class="emoji">üíï</span>
                                    <span data-en="Romantic" data-sw="Kimapenzi">Romantic</span>
                                </div>
                                <div class="mood-btn" data-value="adventurous">
                                    <span class="emoji">üöÄ</span>
                                    <span data-en="Adventurous" data-sw="Mkikamili">Adventurous</span>
                                </div>
                                <div class="mood-btn" data-value="nostalgic">
                                    <span class="emoji">üåÖ</span>
                                    <span data-en="Nostalgic" data-sw="Kumbukumbu">Nostalgic</span>
                                </div>
                            </div>
                        </div>
<!-- Question 2: Energy/Intensity -->
<div class="question" id="question2">
    <h3><span class="emoji">‚ö°</span> <span data-en="How intense? (Pacing/energy)" data-sw="Kiwango cha ukali? (Nguvu/Mwendo)">How intense? (Pacing/energy)</span></h3>
    
    <!-- Emoji Intensity Options -->
    <div class="mood-options" data-question="intensity">
        <div class="mood-btn" data-value="light">
            <span class="emoji">üçÉ</span>
            <span data-en="Light & Easy" data-sw="Mwepesi na Rahisi">Light & Easy</span>
        </div>
        <div class="mood-btn" data-value="medium">
            <span class="emoji">‚öñÔ∏è</span>
            <span data-en="Medium" data-sw="Kati">Medium</span>
        </div>
        <div class="mood-btn" data-value="dark">
            <span class="emoji">üåë</span>
            <span data-en="Dark/Heavy" data-sw="Giza/Mzito">Dark/Heavy</span>
        </div>
        <div class="mood-btn" data-value="epic">
            <span class="emoji">üèîÔ∏è</span>
            <span data-en="Epic Journey" data-sw="Safari Kubwa">Epic Journey</span>
        </div>
    </div>
    
    <!-- Energy Level Slider -->
    <div class="slider-container" style="margin-top: 1.5rem;">
        <div class="slider-layout">
            <div class="slider-label low-label" data-en="Low Energy" data-sw="Nishati Ndogo">Low Energy</div>
            <div class="slider-track-wrapper">
                <div class="slider-track"></div>
                <input type="range" min="1" max="10" value="5" class="slider" id="energyLevel" aria-label="Energy level slider" title="Adjust energy level" />
            </div>
            <div class="slider-label high-label" data-en="High Energy" data-sw="Nishati Nyingi">High Energy</div>
        </div>
    </div>
</div>

<!-- Question 3: Preferred Era -->
<div class="question" id="question3">
    <h3><span class="emoji">üìÖ</span> <span data-en="Preferred era?" data-sw="Era unayopenda?">Preferred era?</span></h3>
    <div class="mood-options" data-question="era">
        <div class="mood-btn" data-value="classic">
            <span class="emoji">üé≠</span>
            <span data-en="Classic (pre-1980)" data-sw="Klasiki (kabla ya 1980)">Classic (pre-1980)</span>
        </div>
        <div class="mood-btn" data-value="90s">
            <span class="emoji">üìº</span>
            <span data-en="90s" data-sw="Miaka 90">90s</span>
        </div>
        <div class="mood-btn" data-value="2000s">
            <span class="emoji">üì±</span>
            <span data-en="2000s" data-sw="Miaka 2000">2000s</span>
        </div>
        <div class="mood-btn" data-value="recent">
            <span class="emoji">üé¨</span>
            <span data-en="Recent (2020s)" data-sw="Hivi karibuni (2020s)">Recent (2020s)</span>
        </div>
    </div>
</div>


                        <!-- Question 4: Watching With -->
                        <div class="question" id="question4">
                            <h3><span class="emoji">üë•</span> <span data-en="Are you watching alone or with others?" data-sw="Unaangalia peke yako au na wengine?">Are you watching alone or with others?</span></h3>
                            <div class="mood-options" data-question="watchingWith">
                                <div class="mood-btn" data-value="alone">
                                    <span class="emoji">üôã‚Äç‚ôÄÔ∏è</span>
                                    <span data-en="Solo" data-sw="Peke Yako">Solo</span>
                                </div>
                                <div class="mood-btn" data-value="partner">
                                    <span class="emoji">üíë</span>
                                    <span data-en="Partner" data-sw="Mwenzi">Partner</span>
                                </div>
                                <div class="mood-btn" data-value="friends">
                                    <span class="emoji">üë´</span>
                                    <span data-en="Friends" data-sw="Marafiki">Friends</span>
                                </div>
                                <div class="mood-btn" data-value="family">
                                    <span class="emoji">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                                    <span data-en="Family" data-sw="Familia">Family</span>
                                </div>
                            </div>
                        </div>

                        <!-- Question 5: Watch duration? -->
                        <div class="question" id="question5">
                            <h3><span class="emoji">‚è∞</span> <span data-en="Watch duration?" data-sw="Muda wa kuangalia?">Watch duration?</span></h3>
                            <div class="mood-options" data-question="duration">
                                <div class="mood-btn" data-value="short">
                                    <span class="emoji">‚ö°</span>
                                    <span data-en="&lt; 90min" data-sw="&lt; 90 dakika">&lt; 90min</span>
                                </div>
                                <div class="mood-btn" data-value="standard">
                                    <span class="emoji">üé¨</span>
                                    <span data-en="90-120min" data-sw="90-120 dakika">90-120min</span>
                                </div>
                                <div class="mood-btn" data-value="long">
                                    <span class="emoji">üìΩÔ∏è</span>
                                    <span data-en="&gt; 2hrs" data-sw="&gt; 2 saa">&gt; 2hrs</span>
                                </div>
                                <div class="mood-btn" data-value="series">
                                    <span class="emoji">üì∫</span>
                                    <span data-en="Binge Series" data-sw="Mfululizo">Binge Series</span>
                                </div>
                            </div>
                        </div>
                    </div>

                        <!-- Question 6: Current Thoughts 
                          <div class="question" id="question6">
                            <h3><span class="emoji">üí≠</span> <span data-en="What's on your mind lately?" data-sw="Ni nini kilicho kwenye akili yako hivi karibuni?">What's on your mind lately?</span></h3>
                            <input type="text" class="text-input" id="currentThoughts" 
                                   data-en-placeholder="e.g., work stress, wanting to laugh, missing old friends..." 
                                   data-sw-placeholder="mfano, msongo kazini, kutaka kucheka, kukumbuka rafiki wa zamani..." />
                        </div>
                    </div>
-->
                       
                    <!-- Progress Bar at Bottom -->
                    <div class="progress-container">
                        <div class="progress-text">
                            <span id="progressText" data-en="Question 1 of 5" data-sw="Swali 1 la 6">Question 1 of 5</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="question-navigation">
                        <button class="btn btn-secondary" id="prevBtn" style="display: none;">
                            <i class="fas fa-arrow-left"></i> <span data-en="Previous" data-sw="Iliyopita">Previous</span>
                        </button>
                        <button class="btn btn-primary" id="nextBtn">
                            <span data-en="Next" data-sw="Inayofuata">Next</span> <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>

                    <!-- Discover Button (shown on last question) -->
                    <button class="discover-btn" id="discoverBtn" style="display: none;">
                        <span class="emoji">üéØ</span> <span data-en="Discover My Perfect Movie" data-sw="Gundua Filamu Yangu Kamili">Discover My Perfect Movie</span>
                    </button>

                   <!-- Analysis Text (Hidden by default) -->
                   <div class="analysis-text hidden" id="analysis-text">
                       <h3><span class="emoji">üéâ</span> <span data-en="Great! We're analyzing your mood..." data-sw="Vizuri! Tunachambua hali yako...">Great! We're analyzing your mood...</span></h3>
                       <p data-en="Based on your feelings, we'll find movies that perfectly match your current vibe!"
                          data-sw="Kulingana na hisia zako, tutapata filamu zinazolingana kabisa na hali yako ya sasa!">
                           Based on your feelings, we'll find movies that perfectly match your current vibe!
                       </p>
                   </div>

                   <!-- Recommendation Preview -->
<div class="recommendation-preview" id="recommendationPreview" style="display: none;">
    <h3><span class="emoji">üéØ</span> <span data-en="Finding your perfect match..." data-sw="Kutafuta mechi yako kamili...">Finding your perfect match...</span></h3>
    <p data-en="We're searching through thousands of movies to find the perfect one for you!"
       data-sw="Tunatafuta kati ya maelfu ya filamu kupata ile kamili kwako!">
        We're searching through thousands of movies to find the perfect one for you!
    </p>
</div>

                    <!-- Movie Match Result 
                     <div class="movie-match-actions">
                                    <a href="#" class="watch-now-btn">
                                        <i class="fas fa-play"></i> <span data-en="Watch Now" data-sw="Angalia Sasa">Trailer</span>
                                    </a>
                                    <a href="#" class="try-again-btn" id="tryAgainBtn">
                                        <i class="fas fa-redo"></i> <span data-en="Try Again" data-sw="Jaribu Tena">Try Again</span>
                                    </a>
                                </div>
                          </div> -->
                   
                                

    </section>

    <!-- Statistics Section -->
    <section class="section">
        <div class="container">
            <div class="stats-section">
                <div class="section-header">
                    <h2 class="section-title" data-en="By The Numbers" data-sw="Kwa Nambari">By The Numbers</h2>
                    <p class="section-subtitle" 
                       data-en="Our platform in statistics that showcase our growing community"
                       data-sw="Jukwaa letu katika takwimu zinazoonyesha ukuaji wa jumuiya yetu">Our platform in statistics that showcase our growing community</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-number">10,000+</span>
                        <span class="stat-label" data-en="Movies Available" data-sw="Filamu Zinazopatikana">Movies Available</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">20+</span>
                        <span class="stat-label" data-en="Genres Covered" data-sw="Aina za Filamu">Genres Covered</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">150K+</span>
                        <span class="stat-label" data-en="Happy Users" data-sw="Watumiaji Wenye Furaha">Happy Users</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">94%</span>
                        <span class="stat-label" data-en="Satisfaction Rate" data-sw="Kiwango cha Kuridhika">Satisfaction Rate</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta-section" id="contact">
        <div class="container">
            <h2 class="cta-title" data-en="Ready for Your Perfect Movie Match?" data-sw="Uko Tayari kwa Mechi Yako Kamili ya Filamu?">Ready for Your Perfect Movie Match?</h2>
            <p class="cta-description"
               data-en="Join thousands of movie lovers who discover their next favorite film with CineMatch every day."
               data-sw="Jiunge na maelfu ya wapenzi wa filamu wanaogundua filamu yao inayofuata kupenda na CineMatch kila siku.">
                Join thousands of movie lovers who discover their next favorite film with CineMatch every day.
            </p>
            <a href="#discover" class="btn btn-primary" data-en="Get Started" data-sw="Anza Sasa">
                <i class="fas fa-rocket"></i> Get Started
            </a>
            <a href="/accounts/login/" class="btn btn-secondary" data-en="Login" data-sw="Ingia">
                <i class="fas fa-sign-in-alt"></i> Login
            </a>
        </div>
    </section>

    <!-- JavaScript -->
    <script>
        // Preload color scheme preferences
        (function() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme) {
                document.body.setAttribute('data-theme', savedTheme);
            } else if (prefersDark) {
                document.body.setAttribute('data-theme', 'dark');
            } else {
                document.body.setAttribute('data-theme', 'light');
            }
        })();

        // Scroll to top on page load
        window.onload = function() {
            window.scrollTo(0, 0);
        };

        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const langToggle = document.getElementById('languageToggle');
        const rootElement = document.body;

        themeToggle.addEventListener('click', () => {
            const newTheme = rootElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            rootElement.setAttribute('data-theme', newTheme);
            themeToggle.querySelector('.theme-icon').textContent = newTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
            
            // Save preference to localStorage
            localStorage.setItem('theme', newTheme);
        });

        // Language Toggle
        langToggle.addEventListener('click', () => {
            const currentLang = rootElement.getAttribute('data-lang');
            const newLang = currentLang === 'en' ? 'sw' : 'en';
            rootElement.setAttribute('data-lang', newLang);
            langToggle.querySelector('span').textContent = newLang === 'en' ? 'SW' : 'EN';

            // Update all elements with data-en and data-sw attributes
            document.querySelectorAll('[data-en]').forEach(el => {
                const attr = `data-${newLang}`;
                if (el.hasAttribute(attr)) {
                    el.textContent = el.getAttribute(attr);
                    
                    // Handle placeholders for input fields
                    if (el.tagName === 'INPUT' && el.hasAttribute(`${attr}-placeholder`)) {
                        el.placeholder = el.getAttribute(`${attr}-placeholder`);
                    }
                }
            });
            
            // Save preference to localStorage
            localStorage.setItem('language', newLang);
        });

        // Scroll Progress
        window.addEventListener('scroll', () => {
            const scrollProgress = document.getElementById('scrollProgress');
            const totalHeight = document.documentElement.scrollHeight - window.innerHeight;
            const progress = (window.scrollY / totalHeight) * 100;
            scrollProgress.style.width = `${progress}%`;
        });

        // Check for saved theme preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            rootElement.setAttribute('data-theme', savedTheme);
            themeToggle.querySelector('.theme-icon').textContent = savedTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
        }

        // Check for saved language preference
        const savedLang = localStorage.getItem('language');
        if (savedLang) {
            rootElement.setAttribute('data-lang', savedLang);
            langToggle.querySelector('span').textContent = savedLang === 'en' ? 'SW' : 'EN';
            
            // Update all elements with data-en and data-sw attributes
            document.querySelectorAll('[data-en]').forEach(el => {
                const attr = `data-${savedLang}`;
                if (el.hasAttribute(attr)) {
                    el.textContent = el.getAttribute(attr);
                    
                    // Handle placeholders for input fields
                    if (el.tagName === 'INPUT' && el.hasAttribute(`${attr}-placeholder`)) {
                        el.placeholder = el.getAttribute(`${attr}-placeholder`);
                    }
                }
            });
        }
        
       // Enhanced Discover Questionnaire Logic
const questions = document.querySelectorAll('.question');
const nextBtn = document.getElementById('nextBtn');
const prevBtn = document.getElementById('prevBtn');
const discoverBtn = document.getElementById('discoverBtn');
const progressFill = document.getElementById('progressFill');
const progressText = document.getElementById('progressText');
const moodOptions = document.querySelectorAll('.mood-options .mood-btn');
const recommendationPreview = document.getElementById('recommendationPreview');
const movieMatch = document.getElementById('movieMatch');
const tryAgainBtn = document.getElementById('tryAgainBtn');

let currentQuestion = 0;
const totalQuestions = questions.length;
const answers = {};
let lastTap = 0; // For double-tap detection

// Define mandatory questions (1-5, question 6 is optional)
const mandatoryQuestions = [0, 1, 2, 3, 4]; // Questions 1-5 (0-indexed)

// Initialize first question
console.log('Questions found:', questions.length);
console.log('Total questions expected:', totalQuestions);
console.log('First question:', questions[0]);
console.log('All questions:', questions);

// Debug: Log all question elements
questions.forEach((q, index) => {
    console.log(`Question ${index + 1}:`, q);
});

showQuestion(currentQuestion);

// Enhanced mood options handler with special handling for question 2 (intensity)
moodOptions.forEach(option => {
    option.addEventListener('click', function(e) {
        const now = new Date().getTime();
        const timeDiff = now - lastTap;
        
        // Handle selection
        const question = this.parentElement.getAttribute('data-question');
        const value = this.getAttribute('data-value');
        this.parentElement.querySelectorAll('.mood-btn').forEach(btn => {
            btn.classList.remove('selected');
        });
        this.classList.add('selected');
        
        // Special handling for intensity question (question 2)
        if (question === 'intensity') {
            // Initialize or update the intensity object
            if (!answers.intensity) {
                answers.intensity = {};
            }
            answers.intensity.mood = value;
            
            // Preserve existing energy level if it exists
            const energySlider = document.getElementById('energyLevel');
            if (energySlider && !answers.intensity.energyLevel) {
                answers.intensity.energyLevel = energySlider.value;
            }
        } else {
            // Handle other questions normally
            answers[question] = value;
        }
        
        console.log('Updated answers after mood selection:', answers);
        
        // Check for double-tap (300ms threshold)
        if (timeDiff < 300 && timeDiff > 0) {
            // Double-tap detected - auto-advance
            setTimeout(() => {
                if (validateCurrentQuestion()) {
                    nextBtn.click();
                }
            }, 100);
        }
        
        lastTap = now;
        updateProgress();
    });
});

// Enhanced Next button click handler with validation
nextBtn.addEventListener('click', () => {
    console.log('Next button clicked, current question:', currentQuestion);
    console.log('Validation result:', validateCurrentQuestion());
    console.log('Current answers:', answers);
    
    if (validateCurrentQuestion() && currentQuestion < totalQuestions - 1) {
        questions[currentQuestion].classList.remove('active');
        questions[currentQuestion].classList.add('previous');
        currentQuestion++;
        questions[currentQuestion].classList.remove('next');
        questions[currentQuestion].classList.add('active');
        updateProgress();
        questions[currentQuestion].scrollIntoView({ behavior: 'smooth', block: 'center' });
    } else if (!validateCurrentQuestion()) {
        // Show validation feedback
        showValidationFeedback();
    }
});

// Previous button click handler
prevBtn.addEventListener('click', () => {
    if (currentQuestion > 0) {
        questions[currentQuestion].classList.remove('active');
        questions[currentQuestion].classList.add('next');
        currentQuestion--;
        questions[currentQuestion].classList.remove('previous');
        questions[currentQuestion].classList.add('active');
        updateProgress();
        questions[currentQuestion].scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
});

// Enhanced slider initialization with combined storage for question 2 (intensity)
const energySlider = document.getElementById('energyLevel');
if (energySlider) {
    const handleSliderChange = function() {
        const value = this.value;
        console.log('Slider changed to:', value);
        
        // Special handling for intensity question (question 2)
        // Initialize or update the intensity object
        if (!answers.intensity) {
            answers.intensity = {};
        }
        answers.intensity.energyLevel = value;
        
        // Preserve existing mood selection if it exists
        const selectedMood = document.querySelector('.mood-options[data-question="intensity"] .mood-btn.selected');
        if (selectedMood && !answers.intensity.mood) {
            answers.intensity.mood = selectedMood.getAttribute('data-value');
        }
        
        console.log('Updated answers after slider change:', answers);
        
        // Update UI effects
        const lowLabel = document.querySelector('.low-label');
        const highLabel = document.querySelector('.high-label');
        
        if (lowLabel && highLabel) {
            lowLabel.classList.remove('glow', 'highlight-missing');
            highLabel.classList.remove('glow', 'highlight-missing');
            
            const numValue = parseInt(value);
            if (numValue <= 4) {
                lowLabel.classList.add('glow');
            } else if (numValue >= 7) {
                highLabel.classList.add('glow');
            }
        }
        
        // Update progress to enable/disable next button
        updateProgress();
    };
    
    energySlider.addEventListener('input', handleSliderChange);
    energySlider.addEventListener('change', handleSliderChange);
    
    // Initialize with default value if not already set
    if (!answers.intensity) {
        answers.intensity = {};
    }
    if (!answers.intensity.energyLevel) {
        answers.intensity.energyLevel = energySlider.value;
    }
}

// Current thoughts input handler (optional)
const currentThoughts = document.getElementById('currentThoughts');
if (currentThoughts) {
    currentThoughts.addEventListener('input', () => {
        answers.currentThoughts = currentThoughts.value;
        updateProgress();
    });
}

// Enhanced Discover button click handler
discoverBtn.addEventListener('click', () => {
    // Validate all mandatory questions
    if (!validateAllMandatoryQuestions()) {
        showValidationFeedback();
        return;
    }
    
    // Show loading state
    discoverBtn.innerHTML = '<div class="loading-spinner"></div> <span data-en="Analyzing..." data-sw="Tunachambua...">Analyzing...</span>';
    discoverBtn.disabled = true;
    
    // Hide analysis text and show recommendation preview
    const analysisText = document.getElementById('analysis-text');
    if (analysisText) {
        analysisText.style.display = 'none';
    }
    
    // Show recommendation preview (analyzing phase)
    if (recommendationPreview) {
        recommendationPreview.style.display = 'block';
        recommendationPreview.style.opacity = '0';
        // Fade in animation
        setTimeout(() => {
            recommendationPreview.style.transition = 'opacity 0.5s ease-in-out';
            recommendationPreview.style.opacity = '1';
        }, 100);
        
        recommendationPreview.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    
    // After 3 seconds of "analyzing", show the movie match modal
    setTimeout(() => {
        showMovieMatchModal();
    }, 3000);
});

// Function to show movie match modal
function showMovieMatchModal() {
    // Create modal if it doesn't exist
    let modal = document.getElementById('movieMatchModal');
    if (!modal) {
        modal = createMovieMatchModal();
        document.body.appendChild(modal);
    }
    
    // Show modal with animation
    modal.style.display = 'flex';
    setTimeout(() => {
        modal.classList.add('show');
    }, 10);
    
    // Prevent body scroll when modal is open
    document.body.style.overflow = 'hidden';
}

// Function to create movie match modal
function createMovieMatchModal() {
    const modal = document.createElement('div');
    modal.id = 'movieMatchModal';
    modal.className = 'movie-modal';
    
      
    // Add event listeners to modal buttons
    modal.querySelector('#modalCloseBtn').addEventListener('click', closeMovieMatchModal);
    modal.querySelector('#tryAnotherBtn').addEventListener('click', () => {
        closeMovieMatchModal();
        // Could trigger another recommendation here
    });
    modal.querySelector('#startOverBtn').addEventListener('click', () => {
        closeMovieMatchModal();
        resetQuestionnaire();
    });
    
    // Close modal when clicking backdrop
    modal.querySelector('.modal-backdrop').addEventListener('click', closeMovieMatchModal);
    
    return modal;
}

// Function to close movie match modal
function closeMovieMatchModal() {
    const modal = document.getElementById('movieMatchModal');
    if (modal) {
        modal.classList.remove('show');
        setTimeout(() => {
            modal.style.display = 'none';
        }, 300);
    }
    
    // Restore body scroll
    document.body.style.overflow = '';
}

// Function to reset questionnaire
function resetQuestionnaire() {
    // Reset current question
    currentQuestion = 0;
    
    // Clear all answers
    Object.keys(answers).forEach(key => delete answers[key]);
    
    // Reset all UI elements
    document.querySelectorAll('.mood-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    
    if (energySlider) {
        energySlider.value = 5; // Reset to middle
    }
    
    if (currentThoughts) {
        currentThoughts.value = '';
    }
    
    // Hide recommendation preview and analysis text
    if (recommendationPreview) {
        recommendationPreview.style.display = 'none';
        recommendationPreview.style.opacity = '0';
    }
    
    const analysisText = document.getElementById('analysis-text');
    if (analysisText) {
        analysisText.style.display = 'none';
        analysisText.classList.add('hidden');
    }
    
    // Reset discover button
    if (discoverBtn) {
        discoverBtn.innerHTML = '<span class="emoji">üéØ</span> <span data-en="Discover My Perfect Movie" data-sw="Gundua Filamu Yangu Kamili">Discover My Perfect Movie</span>';
        discoverBtn.disabled = true;
    }
    
    // Show first question
    showQuestion(0);
    
    // Scroll to top
    questions[0].scrollIntoView({ behavior: 'smooth' });
}

// Updated validation function with special handling for question 2 (intensity)
function validateCurrentQuestion() {
    console.log('Validating question:', currentQuestion, 'Answers:', answers);
    
    switch (currentQuestion) {
        case 0: // Question 1 - Current Mood
            return answers.currentMood !== undefined;
            
        case 1: // Question 2 - Intensity (requires both mood and energy level)
            return answers.intensity && 
                   answers.intensity.mood !== undefined && 
                   answers.intensity.energyLevel !== undefined;
            
        case 2: // Question 3 - Era
            return answers.era !== undefined;
            
        case 3: // Question 4 - Watching With
            return answers.watchingWith !== undefined;
            
        case 4: // Question 5 - Time Available
            return answers.timeAvailable !== undefined;
            
        case 5: // Question 6 - Current thoughts (optional)
            return true; // Always valid since it's optional
            
        default:
            return false;
    }
}

// Helper function to check if question 2 (intensity) is complete
function isQuestion2Complete() {
    return answers.intensity && 
           answers.intensity.mood && 
           answers.intensity.energyLevel;
}

// Validate all mandatory questions
function validateAllMandatoryQuestions() {
    return mandatoryQuestions.every(questionIndex => {
        if (questionIndex === 1) { // Question 2 - Intensity
            return isQuestion2Complete();
        } else {
            const questionKey = getQuestionKey(questionIndex);
            return answers[questionKey] !== undefined;
        }
    });
}

// Helper function to get question key by index
function getQuestionKey(questionIndex) {
    const questionKeys = ['currentMood', 'intensity', 'era', 'watchingWith', 'timeAvailable', 'currentThoughts'];
    return questionKeys[questionIndex];
}

// Updated progress function with special handling for question 2 (intensity)
function updateProgress() {
    let completedQuestions = 0;
    
    // Check each mandatory question
    mandatoryQuestions.forEach(questionIndex => {
        if (questionIndex === 1) { // Question 2 - Intensity
            if (isQuestion2Complete()) {
                completedQuestions++;
            }
        } else {
            // Check other questions normally
            const questionKey = getQuestionKey(questionIndex);
            if (answers[questionKey] !== undefined) {
                completedQuestions++;
            }
        }
    });
    
    const progress = (completedQuestions / mandatoryQuestions.length) * 100;
    if (progressFill) {
        progressFill.style.width = `${progress}%`;
    }
    if (progressText) {
        progressText.textContent = `${Math.round(progress)}%`;
    }
    
    // Enable/disable buttons based on current question validation
    const isCurrentValid = validateCurrentQuestion();
    if (nextBtn) {
        nextBtn.disabled = !isCurrentValid;
    }
    
    // Enable discover button only if all mandatory questions are complete
    const allMandatoryComplete = validateAllMandatoryQuestions();
    if (discoverBtn) {
        discoverBtn.disabled = !allMandatoryComplete;
    }
    
    console.log('Progress updated:', {
        completedQuestions,
        progress,
        isCurrentValid,
        allMandatoryComplete,
        currentAnswers: answers
    });
}

// Show question function with enhanced debugging
function showQuestion(questionIndex) {
    console.log(`Showing question ${questionIndex + 1} of ${totalQuestions}`);
    
    questions.forEach((question, index) => {
        question.classList.remove('active', 'previous', 'next');
        if (index === questionIndex) {
            question.classList.add('active');
            console.log(`Question ${index + 1} set to active:`, question);
        } else if (index < questionIndex) {
            question.classList.add('previous');
        } else {
            question.classList.add('next');
        }
    });
    
    // Update button states
    if (prevBtn) {
        prevBtn.disabled = questionIndex === 0;
        // Show/hide previous button
        if (questionIndex === 0) {
            prevBtn.style.display = 'none';
        } else {
            prevBtn.style.display = 'inline-flex';
        }
    }
    
    // Show/hide next button vs discover button
    if (nextBtn && discoverBtn) {
        if (questionIndex === totalQuestions - 1) {
            // Last question - show discover button, hide next
            nextBtn.style.display = 'none';
            discoverBtn.style.display = 'inline-block';
            
            // Show analysis text on last question
            const analysisText = document.getElementById('analysis-text');
            if (analysisText) {
                analysisText.classList.remove('hidden');
                analysisText.style.display = 'block';
            }
        } else {
            // Not last question - show next button, hide discover
            nextBtn.style.display = 'inline-block';
            discoverBtn.style.display = 'none';
            
            // Hide analysis text on other questions
            const analysisText = document.getElementById('analysis-text');
            if (analysisText) {
                analysisText.classList.add('hidden');
                analysisText.style.display = 'none';
            }
        }
    }
    
    updateProgress();
}

// Show validation feedback with special handling for question 2 (intensity)
function showValidationFeedback() {
    console.log('Showing validation feedback for question:', currentQuestion);
    
    // Add visual feedback for missing selections
    const currentQuestionElement = questions[currentQuestion];
    
    if (currentQuestion === 1) { // Question 2 - Intensity (special handling)
        // Check what's missing
        const hasMood = answers.intensity && answers.intensity.mood;
        const hasEnergyLevel = answers.intensity && answers.intensity.energyLevel;
        
        if (!hasMood) {
            const moodOptions = currentQuestionElement.querySelectorAll('.mood-btn');
            moodOptions.forEach(btn => btn.classList.add('highlight-missing'));
            setTimeout(() => {
                moodOptions.forEach(btn => btn.classList.remove('highlight-missing'));
            }, 3000);
        }
        
        if (!hasEnergyLevel) {
            const sliderLabels = currentQuestionElement.querySelectorAll('.slider-label');
            sliderLabels.forEach(label => label.classList.add('highlight-missing'));
            setTimeout(() => {
                sliderLabels.forEach(label => label.classList.remove('highlight-missing'));
            }, 3000);
        }
    } else {
        // Handle other questions
        const options = currentQuestionElement.querySelectorAll('.mood-btn');
        options.forEach(option => option.classList.add('highlight-missing'));
        setTimeout(() => {
            options.forEach(option => option.classList.remove('highlight-missing'));
        }, 3000);
    }
}

// Try again button handler (if it exists)
if (tryAgainBtn) {
    tryAgainBtn.addEventListener('click', () => {
        resetQuestionnaire();
    });
}

// Smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        
        const targetId = this.getAttribute('href');
        if (targetId === '#') return;
        
        const targetElement = document.querySelector(targetId);
        if (targetElement) {
            targetElement.scrollIntoView({
                behavior: 'smooth'
            });
        }
    });
});

// Animate elements when they come into view
const animateOnScroll = () => {
    const elements = document.querySelectorAll('.feature-card, .movie-card');
    
    elements.forEach(element => {
        const elementPosition = element.getBoundingClientRect().top;
        const windowHeight = window.innerHeight;
        
        if (elementPosition < windowHeight - 100) {
            element.style.opacity = '1';
            element.style.transform = 'translateY(0)';
        }
    });
};

// Set initial state for animation
document.querySelectorAll('.feature-card, .movie-card').forEach(element => {
    element.style.opacity = '0';
    element.style.transform = 'translateY(20px)';
    element.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
});

// Add scroll event listener
window.addEventListener('scroll', animateOnScroll);

// Trigger once on page load
animateOnScroll();

// Initialize the questionnaire
updateProgress();
// Initialize the questionnaire
updateProgress();

        // === STRICT TRAILER ENFORCEMENT ===
        // YouTube ID validation pattern
        const YOUTUBE_ID_PATTERN = /^[a-zA-Z0-9_-]{11}$/;
        
        // Enhanced trailer filtering function with strict validation
        async function filterMoviesWithTrailers(movies) {
            const validMovies = [];
            
            for (const movie of movies) {
                try {
                    // Fetch trailer ID for each movie
                    const mediaType = movie.media_type || 'movie';
                    const trailerId = await fetchTrailerId(movie.id, mediaType);
                    
                    // Validate trailer availability
                    if (trailerId && trailerId.match(YOUTUBE_ID_PATTERN) && trailerId !== 'dQw4w9WgXcQ') {
                        movie.trailerId = trailerId; // Store the validated trailer ID
                        validMovies.push(movie);
                    }
                } catch (error) {
                    console.log(`Failed to fetch trailer for ${movie.title || movie.name}:`, error);
                }
            }
            
            const removedCount = movies.length - validMovies.length;
            if (removedCount > 0) {
                console.warn(`üö´ Trailer Enforcement: Removed ${removedCount} trailer-less movies from display`);
            }
            
            return validMovies;
        }
        
        // YouTube ID validation helper
        function isValidYouTubeId(trailerId) {
            return trailerId && trailerId.match(YOUTUBE_ID_PATTERN) && trailerId !== 'dQw4w9WgXcQ';
        }
        
        // Content validation function for strict trailer enforcement
        function validateContentForTrailers(content) {
            if (!content || !Array.isArray(content)) return [];
            
            return content.filter(item => {
                // Must have a valid trailer ID
                if (!item.trailerId) return false;
                
                // Must match YouTube ID pattern
                if (!item.trailerId.match(YOUTUBE_ID_PATTERN)) return false;
                
                // Must not be placeholder
                if (item.trailerId === 'dQw4w9WgXcQ') return false;
                
                return true;
            });
        }
        
        // Responsive poster system
        function getOptimalPoster(movie) {
            const isMobile = window.innerWidth < 600;
            
            // Check for smallPoster field first (mobile-optimized)
            if (isMobile && movie.smallPoster) {
                return movie.smallPoster;
            }
            
            // Fallback to regular poster with appropriate sizing
            if (movie.poster_path) {
                const baseUrl = 'https://image.tmdb.org/t/p/';
                const size = isMobile ? 'w342' : 'w500'; // Smaller for mobile
                return `${baseUrl}${size}${movie.poster_path}`;
            }
            
            return '/static/img/placeholder.png';
        }
        
        // Enhanced YouTube API implementation (mirroring discover.html)
        function loadTrailer(id) {
            const trailerContainer = document.getElementById('youtubeContainer');
            if (!trailerContainer) return;
            
            // Show loading skeleton
            trailerContainer.innerHTML = `
                <div class="youtube-skeleton">
                    <div class="loader"></div>
                </div>
            `;
            
            // Display container
            trailerContainer.style.display = 'flex';
            
            // Load trailer after a brief delay for smooth transition
            setTimeout(() => {
                trailerContainer.innerHTML = `
                    <button class="youtube-close" id="youtubeClose">‚úï</button>
                    <iframe 
                        src="https://www.youtube.com/embed/${id}?autoplay=1" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; encrypted-media; gyroscope"
                        class="youtube-iframe"
                    ></iframe>
                `;
                
                // Add close functionality
                const closeBtn = document.getElementById('youtubeClose');
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        trailerContainer.style.display = 'none';
                    });
                }
                
                // Close on backdrop click
                trailerContainer.addEventListener('click', (e) => {
                    if (e.target === trailerContainer) {
                        trailerContainer.style.display = 'none';
                    }
                });
            }, 300);
        }
        
        // Responsive poster update on resize
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                // Update all movie cards with optimal posters
                const movieCards = document.querySelectorAll('.movie-card img');
                movieCards.forEach(img => {
                    const movieCard = img.closest('.movie-card');
                    if (movieCard && movieCard.dataset.movie) {
                        const movie = JSON.parse(movieCard.dataset.movie);
                        img.src = getOptimalPoster(movie);
                    }
                });
            }, 250);
        });

        // TMDB Hero Background Slider (daily, random, high-quality, no consecutive repeats)
        const TMDB_API_KEY = 'b6e814a0b9ff291122e8a05a0f206cd8';
        const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
        const TMDB_IMAGE_BASE = 'https://image.tmdb.org/t/p/original';
        window.TMDB_API_KEY = TMDB_API_KEY;

        let heroSlides = [];
        let heroSlideIndex = 0;
        let heroSlideInterval = null;
        let heroMedia = [];
        let heroRefreshCount = 0;
        let heroLastRefreshes = [];

        // Helper to fetch popular and high-rated movies/TV with strict trailer enforcement
        async function fetchHeroMedia() {
            // Popular movies and TV shows, sorted by rating
            const [movieRes, tvRes] = await Promise.all([
                fetch(`${TMDB_BASE_URL}/movie/popular?api_key=${TMDB_API_KEY}&language=en-US&page=1`),
                fetch(`${TMDB_BASE_URL}/tv/popular?api_key=${TMDB_API_KEY}&language=en-US&page=1`)
            ]);
            const [movieData, tvData] = await Promise.all([movieRes.json(), tvRes.json()]);
            let movies = movieData.results.filter(m => m.vote_average >= 7.5);
            let tvs = tvData.results.filter(t => t.vote_average >= 7.5);
            // Tag type for later
            movies = movies.map(m => ({...m, media_type: 'movie'}));
            tvs = tvs.map(t => ({...t, media_type: 'tv'}));
            let all = [...movies, ...tvs];
            
            // Apply strict trailer filtering - only include movies with valid trailers
            const filtered = await filterMoviesWithTrailers(all);
            
            if (filtered.length === 0) {
                console.error('üö´ Trailer Enforcement: No valid trailer movies available for hero section');
                return [];
            }
            
            // Shuffle and pick 5 from trailer-validated movies
            all = filtered.sort(() => Math.random() - 0.5).slice(0, 5);
            return all;
        }

        // Genre mapping for overlay styling
        const HERO_GENRE_MAP = {
            28: 'action', 12: 'adventure', 16: 'animation', 35: 'comedy', 80: 'crime', 99: 'documentary',
            18: 'drama', 10751: 'family', 14: 'fantasy', 36: 'history', 27: 'horror', 10402: 'musical',
            9648: 'mystery', 10749: 'romance', 878: 'sci-fi', 10770: 'tv-movie', 53: 'thriller',
            10752: 'war', 37: 'western', 53: 'thriller', 10759: 'action', 10762: 'family', 10763: 'news',
            10764: 'reality', 10765: 'sci-fi', 10766: 'soap', 10767: 'talk', 10768: 'war'
        };
        function getHeroGenreClass(genre_ids) {
            if (!genre_ids || !genre_ids.length) return 'genre-drama';
            for (const id of genre_ids) {
                if (HERO_GENRE_MAP[id]) return 'genre-' + HERO_GENRE_MAP[id];
            }
            return 'genre-drama';
        }
        function getHeroTag(movie) {
            // Example: trending if vote_count high, now playing if release_date is recent
            const now = new Date();
            if (movie.release_date) {
                const rel = new Date(movie.release_date);
                if ((now - rel) < 1000*60*60*24*30) return '<span class="hero-tag now-playing">Now Playing</span>';
            }
            if (movie.popularity > 1000 || movie.vote_count > 2000) return '<span class="hero-tag trending">Trending</span>';
            return '';
        }
        function getHeroDesc(movie) {
            // Optionally tweak tone by genre
            if (!movie.overview) return '';
            const genre = getHeroGenreClass(movie.genre_ids);
            if (genre === 'genre-thriller') return movie.overview.replace(/\.$/, '!');
            if (genre === 'genre-comedy') return 'üòÇ ' + movie.overview;
            if (genre === 'genre-horror') return '‚ò†Ô∏è ' + movie.overview;
            if (genre === 'genre-romance') return 'üíï ' + movie.overview;
            if (genre === 'genre-musical') return 'üéµ ' + movie.overview;
            return movie.overview;
        }
        function getHeroGenreName(movie) {
            if (!movie.genre_ids || !movie.genre_ids.length) return '';
            const id = movie.genre_ids[0];
            return GENRE_MAP && GENRE_MAP[id] ? GENRE_MAP[id] : '';
        }
        function updateHeroOverlay(idx) {
            if (!heroMedia || !heroMedia.length) return;
            const movie = heroMedia[idx];
            if (!movie) return;
            const overlay = document.getElementById('heroOverlay');
            if (!overlay) return;
            // Remove previous genre classes
            overlay.className = 'hero-overlay';
            const genreClass = getHeroGenreClass(movie.genre_ids);
            overlay.classList.add(genreClass);
            // Title font/placement by genre
            const title = movie.title || movie.name || 'Untitled';
            // Description
            const desc = getHeroDesc(movie);
            // Rating
            const rating = typeof movie.vote_average === 'number' ? movie.vote_average.toFixed(1) : 'N/A';
            // Year
            const year = (movie.release_date || movie.first_air_date || '').slice(0, 4);
            // Genre name
            const genreName = getHeroGenreName(movie);
            // Tag
            const tag = getHeroTag(movie);
            // IMDb/Star icon
            const ratingHtml = `<span class=\"hero-rating\"><i class=\"fas fa-star\"></i> ${rating}</span>`;
            const yearHtml = year ? `<span class=\"hero-year\">${year}</span>` : '';
            const genreHtml = genreName ? `<span class=\"hero-genre\">${genreName}</span>` : '';
            overlay.innerHTML = `
              <div class=\"hero-title\">${title}</div>
              <div class=\"hero-meta\">${ratingHtml} ${yearHtml} ${genreHtml} ${tag}</div>
              <div class=\"hero-desc-bg\"><div class=\"hero-desc\">${desc}</div></div>
            `;
        }
        // Update overlay on slide change
        function goToHeroSlide(idx) {
            if (!heroSlides.length) return;
            heroSlides[heroSlideIndex].classList.remove('active');
            heroSlideIndex = (idx + heroSlides.length) % heroSlides.length;
            heroSlides[heroSlideIndex].classList.add('active');
            updateHeroOverlay(heroSlideIndex);
            setTimeout(setHeroOverlayTextContrast, 300);
        }
        // Also call after initial load
        if (document.querySelector('.hero-bg-slider')) {
            setTimeout(setHeroOverlayTextContrast, 1200);
        }
        // Initial overlay update after loading backgrounds with strict trailer enforcement
        async function loadHeroBackgrounds(forceRefresh=false) {
            try {
                heroMedia = await fetchHeroMedia();
                
                // Check if we have any valid trailer movies
                if (!heroMedia || heroMedia.length === 0) {
                    console.error('üö´ Trailer Enforcement: No valid trailer movies available for hero section');
                    const hero = document.querySelector('.hero');
                    if (hero) {
                        hero.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    }
                    return;
                }
                
                const slider = document.querySelector('.hero-bg-slider');
                if (!slider) return;
                slider.innerHTML = '';
                heroMedia.forEach((item, idx) => {
                    const img = document.createElement('img');
                    img.src = `${TMDB_IMAGE_BASE}${item.backdrop_path}`;
                    img.className = 'hero-bg-slide' + (idx === 0 ? ' active' : '');
                    img.alt = item.title || item.name;
                    img.style.objectFit = 'cover';
                    img.style.width = '100%';
                    img.style.height = '100%';
                    slider.appendChild(img);
                });
                heroSlides = document.querySelectorAll('.hero-bg-slide');
                heroSlideIndex = 0;
                if (heroSlideInterval) clearInterval(heroSlideInterval);
                heroSlideInterval = setInterval(() => {
                    goToHeroSlide((heroSlideIndex + 1) % heroSlides.length);
                }, 10000);
                updateHeroOverlay(heroSlideIndex);
            } catch (e) {
                console.error('Error loading hero backgrounds:', e);
            }
        }

        // Navigation arrow logic
        const heroArrowLeft = document.getElementById('heroArrowLeft');
        const heroArrowRight = document.getElementById('heroArrowRight');
        if (heroArrowLeft && heroArrowRight) {
            heroArrowLeft.onclick = () => {
                goToHeroSlide(heroSlideIndex - 1);
            };
            heroArrowRight.onclick = () => {
                goToHeroSlide(heroSlideIndex + 1);
            };
            // Keyboard navigation
            document.addEventListener('keydown', e => {
                if (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA') return;
                if (e.key === 'ArrowLeft') heroArrowLeft.click();
                if (e.key === 'ArrowRight') heroArrowRight.click();
            });
            // Touch/swipe navigation
            let touchStartX = null;
            document.querySelector('.hero').addEventListener('touchstart', e => {
                touchStartX = e.touches[0].clientX;
            });
            document.querySelector('.hero').addEventListener('touchend', e => {
                if (touchStartX === null) return;
                const dx = e.changedTouches[0].clientX - touchStartX;
                if (Math.abs(dx) > 50) {
                    if (dx > 0) heroArrowLeft.click();
                    else heroArrowRight.click();
                }
                touchStartX = null;
            });
        }

        // Refresh button logic
        const heroRefreshBtn = document.getElementById('heroRefreshBtn');
        if (heroRefreshBtn) {
            heroRefreshBtn.onclick = async () => {
                // Animate icon spin
                heroRefreshBtn.classList.add('spinning');
                setTimeout(() => {
                    heroRefreshBtn.classList.remove('spinning');
                    heroRefreshBtn.blur(); // Remove focus so hover/focus effect disappears
                }, 800);
                // Track refreshes in the last hour
                const now = Date.now();
                heroLastRefreshes = heroLastRefreshes.filter(ts => now - ts < 3600000);
                heroLastRefreshes.push(now);
                heroRefreshCount = heroLastRefreshes.length;
                // Refresh hero
                await loadHeroBackgrounds(true);
                // If >3 times in an hour, also refresh featured
                if (heroRefreshCount > 3) {
                    if (typeof loadFeaturedMovies === 'function') {
                        await loadFeaturedMovies();
                    }
                }
            };
        }

        // Initial load
        if (document.querySelector('.hero-bg-slider')) {
            loadHeroBackgrounds();
        }

        // === MOBILE MODAL SYSTEM ===
        const mobileDetailsBtn = document.getElementById('mobileDetailsBtn');
        const movieModal = document.getElementById('movieModal');
        const modalClose = document.getElementById('modalClose');
        const modalArrowLeft = document.getElementById('modalArrowLeft');
        const modalArrowRight = document.getElementById('modalArrowRight');
        const watchTrailer = document.getElementById('watchTrailer');
        const youtubeContainer = document.getElementById('youtubeContainer');
        const youtubeClose = document.getElementById('youtubeClose');
        
        // Modal elements
        const modalPoster = document.getElementById('modalPoster');
        const modalTitle = document.getElementById('modalTitle');
        const modalMeta = document.getElementById('modalMeta');
        const modalDesc = document.getElementById('modalDesc');
        
        let currentModalMovieIndex = 0;
        let youtubeIframeLoaded = false;

        // Mobile details button click handler
        if (mobileDetailsBtn) {
            mobileDetailsBtn.addEventListener('click', () => {
                if (heroMedia && heroMedia.length > 0) {
                    showMovieModal(heroSlideIndex);
                }
            });
        }

        // Unified movie modal system
        function showMovieModal(movieIndex) {
            console.log('üîç showMovieModal called with index:', movieIndex);
            
            if (!heroMedia || !heroMedia[movieIndex]) {
                console.warn('‚ùå No hero media available');
                return;
            }
            
            const movie = heroMedia[movieIndex];
            console.log('üìΩÔ∏è Movie data:', movie);
            
            // CRITICAL: Only show movies with valid trailers
            if (!movie.trailerId || !movie.trailerId.match(YOUTUBE_ID_PATTERN) || movie.trailerId === 'dQw4w9WgXcQ') {
                console.warn(`üö´ Trailer Enforcement: Skipping modal for ${movie.title || movie.name} - no valid trailer`);
                return;
            }
            
            currentModalMovieIndex = movieIndex;
            
            // Update modal content
            modalTitle.textContent = movie.title || movie.name || 'Untitled';
            
            // Update poster with responsive system
            const posterPath = getOptimalPoster(movie);
            modalPoster.innerHTML = `<img src="${posterPath}" alt="${movie.title || movie.name}" />`;
            
            // Update dynamic backdrop with movie poster (full page coverage)
            const modalBackdrop = document.getElementById('modalBackdrop');
            if (modalBackdrop && movie.poster_path) {
                const backdropPath = `https://image.tmdb.org/t/p/original${movie.poster_path}`;
                
                // Pre-load image for better performance
                const img = new Image();
                img.onload = () => {
                    modalBackdrop.style.backgroundImage = `url(${backdropPath})`;
                    modalBackdrop.style.backgroundSize = 'cover';
                    modalBackdrop.style.backgroundPosition = 'center';
                    modalBackdrop.style.filter = 'blur(12px) brightness(0.4)';
                };
                img.src = backdropPath;
            }
            
            // Update meta information
            const rating = typeof movie.vote_average === 'number' ? movie.vote_average.toFixed(1) : 'N/A';
            const year = (movie.release_date || movie.first_air_date || '').slice(0, 4);
            const genre = getGenreName(movie.genre_ids?.[0] || '');
            
            modalMeta.innerHTML = `
                <span class="modal-rating">‚≠ê ${rating}</span>
                <span class="modal-year">${year || 'N/A'}</span>
                <span class="modal-genre">${genre}</span>
            `;
            
            // Update description
            modalDesc.textContent = movie.overview || 'No description available.';
            
            // Set trailer button with validated YouTube ID
            watchTrailer.setAttribute('data-yt-id', movie.trailerId);
            watchTrailer.disabled = false;
            watchTrailer.innerHTML = '<i class="fas fa-play"></i> ‚ñ∂ Play Trailer';
            watchTrailer.style.opacity = '1';
            
            // Show modal with proper state management
            console.log('üé¨ Showing modal...');
            movieModal.style.display = 'flex';
            movieModal.style.opacity = '1';
            document.body.classList.add('modal-open');
            document.body.style.overflow = 'hidden';
            
            // Prevent any immediate closing
            setTimeout(() => {
                if (movieModal.style.display === 'flex') {
                    movieModal.style.opacity = '1';
                    console.log('‚úÖ Modal should be visible now');
                } else {
                    console.warn('‚ö†Ô∏è Modal was closed unexpectedly');
                }
            }, 100);
        }

        // Close modal with proper cleanup
        function closeMovieModal() {
            console.log('üö™ closeMovieModal called');
            movieModal.style.opacity = '0';
            setTimeout(() => {
                movieModal.style.display = 'none';
                document.body.classList.remove('modal-open');
                document.body.style.overflow = '';
                console.log('‚úÖ Modal closed successfully');
            }, 300);
        }

        // Modal close button
        if (modalClose) {
            modalClose.addEventListener('click', closeMovieModal);
        }

        // Modal navigation
        if (modalArrowLeft) {
            modalArrowLeft.addEventListener('click', () => {
                const newIndex = (currentModalMovieIndex - 1 + heroMedia.length) % heroMedia.length;
                showMovieModal(newIndex);
            });
        }

        if (modalArrowRight) {
            modalArrowRight.addEventListener('click', () => {
                const newIndex = (currentModalMovieIndex + 1) % heroMedia.length;
                showMovieModal(newIndex);
            });
        }

        // Watch trailer functionality
        if (watchTrailer) {
            watchTrailer.addEventListener('click', () => {
                const youtubeId = watchTrailer.getAttribute('data-yt-id');
                if (youtubeId) {
                    loadTrailer(youtubeId);
                }
            });
        }

        // Fetch YouTube trailer ID from TMDB
        async function fetchTrailerId(movieId, mediaType = 'movie') {
            try {
                const response = await fetch(`${TMDB_BASE_URL}/${mediaType}/${movieId}/videos?api_key=${TMDB_API_KEY}&language=en-US`);
                const data = await response.json();
                
                // Find the first official trailer
                const trailer = data.results?.find(video => 
                    video.type === 'Trailer' && 
                    (video.site === 'YouTube') &&
                    (video.official || video.name.toLowerCase().includes('trailer'))
                );
                
                return trailer?.key || null;
            } catch (error) {
                console.log('Could not fetch trailer:', error);
                return null;
            }
        }

        // Show YouTube trailer
        function showYouTubeTrailer(youtubeId) {
            if (!youtubeIframeLoaded) {
                // Lazy load YouTube iframe only on first trailer click
                const iframe = document.createElement('iframe');
                iframe.src = `https://www.youtube.com/embed/${youtubeId}?autoplay=1&rel=0&modestbranding=1`;
                iframe.width = '100%';
                iframe.height = '100%';
                iframe.frameBorder = '0';
                iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                iframe.allowFullscreen = true;
                
                youtubeContainer.appendChild(iframe);
                youtubeIframeLoaded = true;
            } else {
                // Update existing iframe
                const iframe = youtubeContainer.querySelector('iframe');
                if (iframe) {
                    iframe.src = `https://www.youtube.com/embed/${youtubeId}?autoplay=1&rel=0&modestbranding=1`;
                }
            }
            
            youtubeContainer.style.display = 'flex';
        }

        // Close YouTube container
        if (youtubeClose) {
            youtubeClose.addEventListener('click', () => {
                youtubeContainer.style.display = 'none';
                const iframe = youtubeContainer.querySelector('iframe');
                if (iframe) {
                    iframe.src = ''; // Stop video
                }
            });
        }

        // Close modal on outside click (only on backdrop, not content)
        movieModal.addEventListener('click', (e) => {
            console.log('üñ±Ô∏è Modal clicked:', e.target);
            // Only close if clicking on the backdrop itself, not the modal content
            if (e.target === movieModal && !e.target.closest('.modal-content')) {
                console.log('üéØ Backdrop clicked, closing modal');
                closeMovieModal();
            } else {
                console.log('üéØ Click was on modal content, not closing');
            }
        });

        // Close YouTube on outside click
        youtubeContainer.addEventListener('click', (e) => {
            if (e.target === youtubeContainer) {
                youtubeContainer.style.display = 'none';
                const iframe = youtubeContainer.querySelector('iframe');
                if (iframe) {
                    iframe.src = ''; // Stop video
                }
            }
        });

        // Keyboard navigation for modal
        document.addEventListener('keydown', (e) => {
            if (movieModal.style.display === 'flex') {
                if (e.key === 'Escape') {
                    closeMovieModal();
                } else if (e.key === 'ArrowLeft') {
                    modalArrowLeft.click();
                } else if (e.key === 'ArrowRight') {
                    modalArrowRight.click();
                }
            }
            
            if (youtubeContainer.style.display === 'flex') {
                if (e.key === 'Escape') {
                    youtubeContainer.style.display = 'none';
                    const iframe = youtubeContainer.querySelector('iframe');
                    if (iframe) {
                        iframe.src = '';
                    }
                }
            }
        });

        // Update mobile details button text on language change
        function updateMobileDetailsButtonText() {
            const currentLang = document.body.getAttribute('data-lang') || 'en';
            const mobileBtn = document.getElementById('mobileDetailsBtn');
            if (mobileBtn) {
                const span = mobileBtn.querySelector('span');
                if (span) {
                    const attr = `data-${currentLang}`;
                    if (span.hasAttribute(attr)) {
                        span.textContent = span.getAttribute(attr);
                    }
                }
            }
        }

        // Call on language change
        langToggle.addEventListener('click', updateMobileDetailsButtonText);
        
        // Initial call
        updateMobileDetailsButtonText();

        // === QUESTIONNAIRE FLOW FIX ===
        function showAnalysisText() {
            const analysisText = document.getElementById('analysis-text');
            if (analysisText && allQuestionsAnswered) {
                analysisText.classList.remove('hidden');
                analysisText.classList.add('show');
            }
        }

        // Check if all questions are answered
        function checkAllQuestionsAnswered() {
            const mandatoryQuestions = ['currentMood', 'energyLevel', 'thinkingLevel', 'watchingWith', 'timeAvailable'];
            return mandatoryQuestions.every(question => answers[question] !== undefined);
        }

        // Update the discover button click handler to show analysis text
        const originalDiscoverBtnClick = discoverBtn.onclick;
        discoverBtn.addEventListener('click', function(e) {
            if (checkAllQuestionsAnswered()) {
                showAnalysisText();
            }
            if (originalDiscoverBtnClick) {
                originalDiscoverBtnClick.call(this, e);
            }
        });

        // TMDB Showcase with 2 Independent Rows (mirroring discover.html)
        const FEATURED_CONTAINER = document.getElementById('featuredMovies');
        const FEATURED_SEARCH_INPUT = document.getElementById('featuredSearchInput');
        const FEATURED_SEARCH_BTN = document.getElementById('featuredSearchBtn');
        
        // Showcase data storage
        let popularMovies = [];
        let trendingMovies = [];
        let currentPopularIndex = 0;
        let currentTrendingIndex = 0;
        
        // Load showcase movies for both rows
        async function loadShowcaseMovies() {
            try {
                // Show loading indicators
                showLoading('popularMoviesLoading');
                showLoading('trendingMoviesLoading');
                
                // Load popular movies for row 1
                const popularRes = await fetch(`${TMDB_BASE_URL}/movie/popular?api_key=${TMDB_API_KEY}&language=en-US&page=1`);
                const popularData = await popularRes.json();
                const filteredPopular = await filterMoviesWithTrailers(popularData.results.slice(0, 20));
                
                // Load trending movies for row 2
                const trendingRes = await fetch(`${TMDB_BASE_URL}/movie/now_playing?api_key=${TMDB_API_KEY}&language=en-US&page=1`);
                const trendingData = await trendingRes.json();
                const filteredTrending = await filterMoviesWithTrailers(trendingData.results.slice(0, 20));
                
                if (filteredPopular.length === 0 && filteredTrending.length === 0) {
                    console.error('üö´ Trailer Enforcement: No valid trailer movies available for showcase');
                    hideLoading('popularMoviesLoading');
                    hideLoading('trendingMoviesLoading');
                    return;
                }
                
                popularMovies = filteredPopular;
                trendingMovies = filteredTrending;
                
                // Render both rows
                renderShowcaseRow('popularMoviesRow', popularMovies, 0);
                renderShowcaseRow('trendingMoviesRow', trendingMovies, 0);
                
                // Setup navigation
                setupShowcaseNavigation();
                
                // Hide loading indicators
                hideLoading('popularMoviesLoading');
                hideLoading('trendingMoviesLoading');
                
            } catch (e) {
                console.error('Error loading showcase movies:', e);
                hideLoading('popularMoviesLoading');
                hideLoading('trendingMoviesLoading');
            }
        }
        
        // Show loading indicator
        function showLoading(loadingId) {
            const loadingElement = document.getElementById(loadingId);
            if (loadingElement) {
                loadingElement.classList.remove('hidden');
            }
        }
        
        // Hide loading indicator
        function hideLoading(loadingId) {
            const loadingElement = document.getElementById(loadingId);
            if (loadingElement) {
                loadingElement.classList.add('hidden');
            }
        }
        
        // Render showcase row with movies
        function renderShowcaseRow(rowId, movies, startIndex) {
            const row = document.getElementById(rowId);
            if (!row || !movies || movies.length === 0) return;
            
            // Clear loading indicator
            const loadingElement = row.querySelector('.loading-indicator');
            if (loadingElement) {
                loadingElement.classList.add('hidden');
            }
            
            // Get 4 movies starting from startIndex
            const moviesToShow = movies.slice(startIndex, startIndex + 4);
            
            // Create movie cards
            const movieCards = moviesToShow.map(movie => createMovieCard(movie)).join('');
            
            // Update row content
            row.innerHTML = movieCards;
            
            // Setup card interactions
            setupMovieCardInteractions(row);
        }
        
        // Create movie card HTML (restoring original flip card design, poster fills card)
        function createMovieCard(movie) {
                const isTV = movie.media_type === 'tv' || movie.first_air_date;
                const title = movie.title || movie.name || 'Untitled';
                const year = (movie.release_date || movie.first_air_date || '').slice(0, 4);
            const poster = getOptimalPoster(movie);
                const genre = Array.isArray(movie.genre_ids) && movie.genre_ids.length ? getGenreName(movie.genre_ids[0]) : 'Other';
                const rating = typeof movie.vote_average === 'number' ? movie.vote_average : 'N/A';
                const votes = typeof movie.vote_count === 'number' ? movie.vote_count : 'N/A';
                const lang = movie.original_language ? movie.original_language.toUpperCase() : 'N/A';
                const overview = movie.overview || 'No description available.';
            
                return `
            <div class="movie-card" tabindex="0" data-movie='${JSON.stringify(movie)}'>
                    <div class="card-inner">
                        <div class="card-front">
                        <div class="poster-wrapper">
                            <img class="poster-image" src="${poster}" alt="${title}" loading="lazy" />
                            <div class="card-details-preview">
                                <span class="details-text">${title} ‚Ä¢ ${year} ‚Ä¢ ${rating}‚≠ê ‚Ä¢ ${genre}</span>
                            </div>
                        </div>
                            <div class="card-meta">
                                <span class="genre">${genre}${isTV ? ' <span class=\'tv-badge\'>TV</span>' : ''}</span>
                                <span class="rating">‚≠ê ${rating}</span>
                                <span class="year">${year}</span>
                            </div>
                        </div>
                        <div class="card-back">
                            <button class="close-detail" aria-label="Close">&times;</button>
                            <h3 class="movie-title">${title.length > 32 ? title.slice(0, 29) + '‚Ä¶' : title}</h3>
                            <div class="movie-description" style="overflow:auto;max-height:160px;">${overview}</div>
                            <div class="movie-details-grid" style="margin-top:1rem;display:grid;grid-template-columns:1fr 1fr;gap:0.5rem 1.2rem;">
                                <div><strong>Rating:</strong> ${rating}</div>
                                <div><strong>Year:</strong> ${year || 'N/A'}</div>
                                <div><strong>Language:</strong> ${lang}</div>
                                <div><strong>Votes:</strong> ${votes}</div>
                            </div>
                        ${movie.trailerId ? `<button class="watch-trailer-btn" onclick="loadTrailer('${movie.trailerId}')">
                            <i class="fas fa-play"></i> ‚ñ∂ Play Trailer
                        </button>` : ''}
                        </div>
                    </div>
                </div>
                `;
        }
        
        // Setup movie card interactions (flip on click only, details bar JS controlled)
        function setupMovieCardInteractions(row) {
            const cards = row.querySelectorAll('.movie-card');
            cards.forEach(card => {
                const inner = card.querySelector('.card-inner');
                const closeBtn = card.querySelector('.close-detail');
                const detailsBar = card.querySelector('.card-details-preview');
                if (!inner) return;

                // Show details bar on hover/focus/touch, hide on leave/blur
                function showDetails() {
                    // Hide all others
                    row.querySelectorAll('.movie-card.show-details').forEach(c => c.classList.remove('show-details'));
                    card.classList.add('show-details');
                }
                function hideDetails() {
                    card.classList.remove('show-details');
                }
                card.addEventListener('mouseenter', showDetails);
                card.addEventListener('mouseleave', hideDetails);
                card.addEventListener('focus', showDetails);
                card.addEventListener('blur', hideDetails);
                card.addEventListener('touchstart', function(e) { showDetails(); }, {passive:true});

                // Flip on click
                card.addEventListener('click', (e) => {
                    if (card.classList.contains('flipped')) return;
                    cards.forEach(c => c.classList.remove('flipped'));
                    card.classList.add('flipped');
                    e.stopPropagation();
                });
                if (closeBtn) {
                    closeBtn.addEventListener('click', (e) => {
                        card.classList.remove('flipped');
                        e.stopPropagation();
                    });
                }
            });
            // Close flipped cards when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.movie-card')) {
                    cards.forEach(card => card.classList.remove('flipped'));
                }
            });
        }
        

        
        // Setup showcase navigation arrows
        function setupShowcaseNavigation() {
            // Popular movies navigation
            const popularLeftArrow = document.getElementById('popularMoviesLeftArrow');
            const popularRightArrow = document.getElementById('popularMoviesRightArrow');
            
            if (popularLeftArrow && popularRightArrow) {
                popularLeftArrow.addEventListener('click', () => {
                    if (currentPopularIndex > 0) {
                        currentPopularIndex--;
                        renderShowcaseRow('popularMoviesRow', popularMovies, currentPopularIndex);
                        updateArrowStates('popularMoviesLeftArrow', 'popularMoviesRightArrow', currentPopularIndex, popularMovies.length);
                    }
                });
                
                popularRightArrow.addEventListener('click', () => {
                    if (currentPopularIndex < Math.max(0, popularMovies.length - 4)) {
                        currentPopularIndex++;
                        renderShowcaseRow('popularMoviesRow', popularMovies, currentPopularIndex);
                        updateArrowStates('popularMoviesLeftArrow', 'popularMoviesRightArrow', currentPopularIndex, popularMovies.length);
                    }
                });
                
                // Set initial arrow states
                updateArrowStates('popularMoviesLeftArrow', 'popularMoviesRightArrow', currentPopularIndex, popularMovies.length);
            }
            
            // Trending movies navigation
            const trendingLeftArrow = document.getElementById('trendingMoviesLeftArrow');
            const trendingRightArrow = document.getElementById('trendingMoviesRightArrow');
            
            if (trendingLeftArrow && trendingRightArrow) {
                trendingLeftArrow.addEventListener('click', () => {
                    if (currentTrendingIndex > 0) {
                        currentTrendingIndex--;
                        renderShowcaseRow('trendingMoviesRow', trendingMovies, currentTrendingIndex);
                        updateArrowStates('trendingMoviesLeftArrow', 'trendingMoviesRightArrow', currentTrendingIndex, trendingMovies.length);
                    }
                });
                
                trendingRightArrow.addEventListener('click', () => {
                    if (currentTrendingIndex < Math.max(0, trendingMovies.length - 4)) {
                        currentTrendingIndex++;
                        renderShowcaseRow('trendingMoviesRow', trendingMovies, currentTrendingIndex);
                        updateArrowStates('trendingMoviesLeftArrow', 'trendingMoviesRightArrow', currentTrendingIndex, trendingMovies.length);
                    }
                });
                
                // Set initial arrow states
                updateArrowStates('trendingMoviesLeftArrow', 'trendingMoviesRightArrow', currentTrendingIndex, trendingMovies.length);
            }
        }
        
        // Update arrow states (enabled/disabled)
        function updateArrowStates(leftArrowId, rightArrowId, currentIndex, totalMovies) {
            const leftArrow = document.getElementById(leftArrowId);
            const rightArrow = document.getElementById(rightArrowId);
            
            if (leftArrow) {
                leftArrow.disabled = currentIndex === 0;
            }
            
            if (rightArrow) {
                rightArrow.disabled = currentIndex >= Math.max(0, totalMovies - 4);
            }
        }
        
        // Movie details function (placeholder)
        function showMovieDetails(movieId, mediaType) {
            console.log(`Show details for ${mediaType} ${movieId}`);
            // This would typically open a modal or navigate to a detail page
        }
        
        // Legacy function for backward compatibility with search
        function renderFeaturedMovies(movies) {
            if (movies && movies.length > 0) {
                popularMovies = movies.slice(0, 20);
                currentPopularIndex = 0;
                renderShowcaseRow('popularMoviesRow', popularMovies, 0);
                updateArrowStates('popularMoviesLeftArrow', 'popularMoviesRightArrow', 0, popularMovies.length);
            }
        }
        
        if (FEATURED_CONTAINER) {
            loadShowcaseMovies();
        }

        // Search functionality
        let searchTimeout;
        let lastSearchController = null;
        const searchBar = document.getElementById('mainSearchBar');

        FEATURED_SEARCH_INPUT.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            if (lastSearchController) lastSearchController.abort();
            
            // Remove loading state
            searchBar.classList.remove('loading');
            
            searchTimeout = setTimeout(async () => {
                const query = FEATURED_SEARCH_INPUT.value.trim();
                if (!query || query.length < 2) {
                    // Reset to original popular movies
                    currentPopularIndex = 0;
                    renderShowcaseRow('popularMoviesRow', popularMovies, 0);
                    updateArrowStates('popularMoviesLeftArrow', 'popularMoviesRightArrow', 0, popularMovies.length);
                    return;
                }
                
                // Add loading state
                searchBar.classList.add('loading');
                
                // Show loading spinner in popular movies row
                const popularRow = document.getElementById('popularMoviesRow');
                if (popularRow) {
                    popularRow.innerHTML = '<div class="loading-indicator"><div class="spinner"></div></div>';
                }
                
                // Fetch from TMDb search/multi
                try {
                    lastSearchController = new AbortController();
                    const res = await fetch(`${TMDB_BASE_URL}/search/multi?api_key=${TMDB_API_KEY}&language=en-US&query=${encodeURIComponent(query)}&page=1`, { signal: lastSearchController.signal });
                    if (!res.ok) throw new Error('API error');
                    const data = await res.json();
                    // Only show movies and TV shows
                    const results = (data.results || []).filter(item => item.media_type === 'movie' || item.media_type === 'tv');
                    if (results.length === 0) {
                        if (popularRow) {
                            popularRow.innerHTML = '<div style="text-align:center;padding:2rem;color:var(--text-secondary);">No results found.</div>';
                        }
                        return;
                    }
                    renderFeaturedMovies(results);
                } catch (e) {
                    if (e.name === 'AbortError') return;
                    // Silently fail - don't show error message
                    currentPopularIndex = 0;
                    renderShowcaseRow('popularMoviesRow', popularMovies, 0);
                    updateArrowStates('popularMoviesLeftArrow', 'popularMoviesRightArrow', 0, popularMovies.length);
                } finally {
                    // Remove loading state
                    searchBar.classList.remove('loading');
                }
            }, 300);
        });
        
        mainSearchBar.addEventListener('submit', async e => {
            e.preventDefault();
            const query = FEATURED_SEARCH_INPUT.value.trim();
            if (!query || query.length < 2) {
                currentPopularIndex = 0;
                renderShowcaseRow('popularMoviesRow', popularMovies, 0);
                updateArrowStates('popularMoviesLeftArrow', 'popularMoviesRightArrow', 0, popularMovies.length);
                return;
            }
            
            // Add loading state
            searchBar.classList.add('loading');
            
            const popularRow = document.getElementById('popularMoviesRow');
            if (popularRow) {
                popularRow.innerHTML = '<div class="loading-indicator"><div class="spinner"></div></div>';
            }
            
            try {
                lastSearchController = new AbortController();
                const res = await fetch(`${TMDB_BASE_URL}/search/multi?api_key=${TMDB_API_KEY}&language=en-US&query=${encodeURIComponent(query)}&page=1`, { signal: lastSearchController.signal });
                if (!res.ok) throw new Error('API error');
                const data = await res.json();
                const results = (data.results || []).filter(item => item.media_type === 'movie' || item.media_type === 'tv');
                if (results.length === 0) {
                    if (popularRow) {
                        popularRow.innerHTML = '<div style="text-align:center;padding:2rem;color:var(--text-secondary);">No results found.</div>';
                    }
                    return;
                }
                renderFeaturedMovies(results);
            } catch (e) {
                if (e.name === 'AbortError') return;
                // Silently fail - don't show error message
                currentPopularIndex = 0;
                renderShowcaseRow('popularMoviesRow', popularMovies, 0);
                updateArrowStates('popularMoviesLeftArrow', 'popularMoviesRightArrow', 0, popularMovies.length);
            } finally {
                // Remove loading state
                searchBar.classList.remove('loading');
            }
        });
        // Add a simple loading spinner style
        if (!document.getElementById('search-spinner-style')) {
            const style = document.createElement('style');
            style.id = 'search-spinner-style';
            style.textContent = `
            .loading-spinner {
                display: inline-block;
                width: 36px;
                height: 36px;
                border: 4px solid var(--color-blue, #3B82F6);
                border-top: 4px solid transparent;
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            `;
            document.head.appendChild(style);
        }
        // TMDB genre mapping (partial, for demo)
        const GENRE_MAP = {
            28: 'Action', 12: 'Adventure', 16: 'Animation', 35: 'Comedy', 80: 'Crime', 99: 'Documentary',
            18: 'Drama', 10751: 'Family', 14: 'Fantasy', 36: 'History', 27: 'Horror', 10402: 'Music',
            9648: 'Mystery', 10749: 'Romance', 878: 'Sci-Fi', 10770: 'TV Movie', 53: 'Thriller',
            10752: 'War', 37: 'Western'
        };
        function getGenreName(id) {
            return GENRE_MAP[id] || 'Other';
        }

        // === DYNAMIC HERO OVERLAY TEXT COLOR BASED ON BACKGROUND ===
        // Utility: Get contrast color (YIQ)
        function getContrastYIQ(hexcolor) {
            hexcolor = hexcolor.replace('#', '');
            if (hexcolor.length === 3) {
                hexcolor = hexcolor[0]+hexcolor[0]+hexcolor[1]+hexcolor[1]+hexcolor[2]+hexcolor[2];
            }
            var r = parseInt(hexcolor.substr(0,2),16);
            var g = parseInt(hexcolor.substr(2,2),16);
            var b = parseInt(hexcolor.substr(4,2),16);
            var yiq = ((r*299)+(g*587)+(b*114))/1000;
            return (yiq >= 128) ? 'black' : 'white';
        }
        // Use Color Thief to get dominant color from hero background image
        // (Color Thief CDN)
        if (!window.ColorThief) {
            var colorThiefScript = document.createElement('script');
            colorThiefScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.2/color-thief.umd.js';
            document.head.appendChild(colorThiefScript);
        }
        function setHeroOverlayTextContrast() {
            const overlay = document.getElementById('heroOverlay');
            const headline = document.getElementById('heroHeadline');
            const subtext = document.getElementById('heroSubtext');
            const activeImg = document.querySelector('.hero-bg-slide.active');
            if (!overlay || !headline || !subtext || !activeImg) return;
            // Wait for Color Thief to load
            if (!window.ColorThief || !activeImg.complete) {
                setTimeout(setHeroOverlayTextContrast, 200);
                return;
            }
            try {
                const colorThief = new window.ColorThief();
                let rgb = colorThief.getColor(activeImg);
                let hex = '#' + rgb.map(x => x.toString(16).padStart(2, '0')).join('');
                let contrast = getContrastYIQ(hex);
                if (contrast === 'white') {
                    overlay.style.color = '#fff';
                    headline.style.color = '#fff';
                    subtext.style.color = '#fff';
                    overlay.style.textShadow = '0 2px 8px rgba(0,0,0,0.85)';
                    headline.style.textShadow = '0 2px 8px rgba(0,0,0,0.85)';
                    subtext.style.textShadow = '0 2px 8px rgba(0,0,0,0.85)';
                } else {
                    overlay.style.color = '#18181b';
                    headline.style.color = '#18181b';
                    subtext.style.color = '#18181b';
                    overlay.style.textShadow = '0 2px 8px rgba(255,255,255,0.85)';
                    headline.style.textShadow = '0 2px 8px rgba(255,255,255,0.85)';
                    subtext.style.textShadow = '0 2px 8px rgba(255,255,255,0.85)';
                }
            } catch (e) {
                // fallback: always white
                overlay.style.color = '#fff';
                headline.style.color = '#fff';
                subtext.style.color = '#fff';
                overlay.style.textShadow = '0 2px 8px rgba(0,0,0,0.85)';
                headline.style.textShadow = '0 2px 8px rgba(0,0,0,0.85)';
                subtext.style.textShadow = '0 2px 8px rgba(0,0,0,0.85)';
            }
        }
        // Call on hero slide change
        function goToHeroSlide(idx) {
            if (!heroSlides.length) return;
            heroSlides[heroSlideIndex].classList.remove('active');
            heroSlideIndex = (idx + heroSlides.length) % heroSlides.length;
            heroSlides[heroSlideIndex].classList.add('active');
            updateHeroOverlay(heroSlideIndex);
            setTimeout(setHeroOverlayTextContrast, 300);
        }
        // Also call after initial load
        if (document.querySelector('.hero-bg-slider')) {
            setTimeout(setHeroOverlayTextContrast, 1200);
        }

        // === CAROUSEL LOGIC FOR TRENDING MOVIES & TV SHOWS ===
        const CAROUSEL_CARD_WIDTH = {
          desktop: 19.5, // 100/5.5
          tablet: 28.5,  // 100/3.5
          mobile: 45.5   // 100/2.2
        };
        function getCarouselCardWidth() {
          if (window.innerWidth < 600) return CAROUSEL_CARD_WIDTH.mobile;
          if (window.innerWidth < 1024) return CAROUSEL_CARD_WIDTH.tablet;
          return CAROUSEL_CARD_WIDTH.desktop;
        }
        function createCarousel(cards, carouselId) {
          const carousel = document.getElementById(carouselId);
          if (!carousel) return;
          carousel.innerHTML = '';
          // Duplicate first/last for infinite loop
          const items = [cards[cards.length-1], ...cards, cards[0]];
          items.forEach((card, i) => {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'carousel-card';
            cardDiv.innerHTML = card;
            carousel.appendChild(cardDiv);
          });
          // Set scroll snap and width
          const cardWidth = getCarouselCardWidth();
          carousel.style.gridTemplateColumns = `repeat(${items.length}, ${cardWidth}vw)`;
        }
        // Fetch trending movies/TV and render carousels
        async function loadTrendingCarousels() {
          // Use TMDB API as in hero section
          const TMDB_API_KEY = 'b6e814a0b9ff291122e8a05a0f206cd8';
          const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
          const TMDB_IMAGE_BASE = 'https://image.tmdb.org/t/p/w500';
          // Movies
          const movieRes = await fetch(`${TMDB_BASE_URL}/movie/popular?api_key=${TMDB_API_KEY}&language=en-US&page=1`);
          const movieData = await movieRes.json();
          const movieCards = (movieData.results || []).map(movie => renderMovieCard(movie, TMDB_IMAGE_BASE));
          createCarousel(movieCards, 'trendingMoviesCarousel');
          // TV Shows
          const tvRes = await fetch(`${TMDB_BASE_URL}/tv/popular?api_key=${TMDB_API_KEY}&language=en-US&page=1`);
          const tvData = await tvRes.json();
          const tvCards = (tvData.results || []).map(tv => renderMovieCard(tv, TMDB_IMAGE_BASE));
          createCarousel(tvCards, 'trendingTVCarousel');
        }
        function renderMovieCard(item, imgBase) {
          // Use existing card HTML structure, lazy load images
          const title = item.title || item.name || 'Untitled';
          const year = (item.release_date || item.first_air_date || '').slice(0, 4);
          const poster = getOptimalPoster(item);
          const rating = typeof item.vote_average === 'number' ? item.vote_average.toFixed(1) : 'N/A';
          return `
            <div class="movie-card" tabindex="0">
              <div class="card-inner">
                <div class="card-front">
                  <img class="poster-image" src="${poster}" alt="${title}" loading="lazy" />
                  <div class="card-meta">
                    <span class="rating">‚≠ê ${rating}</span>
                    <span class="year">${year}</span>
                  </div>
                </div>
                <div class="card-back">
                  <button class="close-detail" aria-label="Close">&times;</button>
                  <h3 class="movie-title">${title.length > 32 ? title.slice(0, 29) + '‚Ä¶' : title}</h3>
                  <div class="movie-description" style="overflow:auto;max-height:160px;">${item.overview || 'No description available.'}</div>
                  <div class="movie-details-grid" style="margin-top:1rem;display:grid;grid-template-columns:1fr 1fr;gap:0.5rem 1.2rem;">
                    <div><strong>Rating:</strong> ${rating}</div>
                    <div><strong>Year:</strong> ${year || 'N/A'}</div>
                    <div><strong>Language:</strong> ${(item.original_language || '').toUpperCase()}</div>
                    <div><strong>Votes:</strong> ${item.vote_count || 'N/A'}</div>
                  </div>
                  <div class="movie-match-actions">
                    <a href="#" class="watch-now-btn">
                      <i class="fas fa-play"></i> <span>Watch Now</span>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          `;
        }
        window.addEventListener('DOMContentLoaded', loadTrendingCarousels);

        // Carousel Navigation
        const trendingMoviesCarousel = document.getElementById('trendingMoviesCarousel');
        const trendingTVCarousel = document.getElementById('trendingTVCarousel');
        const trendingMoviesLeftArrow = document.getElementById('trendingMoviesLeftArrow');
        const trendingMoviesRightArrow = document.getElementById('trendingMoviesRightArrow');
        const trendingTVLeftArrow = document.querySelector('.carousel-arrow.left');
        const trendingTVRightArrow = document.querySelector('.carousel-arrow.right');

        function scrollCarousel(carousel, direction) {
            const scrollAmount = carousel.scrollWidth / carousel.children.length;
            if (direction === 'left') {
                carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
            } else {
                carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });
            }
        }

        trendingMoviesCarousel.addEventListener('scroll', () => {
            if (trendingMoviesCarousel.scrollLeft === 0) {
                trendingMoviesCarousel.scrollBy({ left: trendingMoviesCarousel.scrollWidth / 2, behavior: 'smooth' });
            } else if (trendingMoviesCarousel.scrollLeft >= trendingMoviesCarousel.scrollWidth - trendingMoviesCarousel.clientWidth) {
                trendingMoviesCarousel.scrollBy({ left: -trendingMoviesCarousel.scrollWidth / 2, behavior: 'smooth' });
            }
        });

        trendingTVCarousel.addEventListener('scroll', () => {
            if (trendingTVCarousel.scrollLeft === 0) {
                trendingTVCarousel.scrollBy({ left: trendingTVCarousel.scrollWidth / 2, behavior: 'smooth' });
            } else if (trendingTVCarousel.scrollLeft >= trendingTVCarousel.scrollWidth - trendingTVCarousel.clientWidth) {
                trendingTVCarousel.scrollBy({ left: -trendingTVCarousel.scrollWidth / 2, behavior: 'smooth' });
            }
        });

        if (trendingMoviesLeftArrow) {
            trendingMoviesLeftArrow.onclick = () => scrollCarousel(trendingMoviesCarousel, 'left');
        }
        if (trendingMoviesRightArrow) {
            trendingMoviesRightArrow.onclick = () => scrollCarousel(trendingMoviesCarousel, 'right');
        }
        if (trendingTVLeftArrow) {
            trendingTVLeftArrow.onclick = () => scrollCarousel(trendingTVCarousel, 'left');
        }
        if (trendingTVRightArrow) {
            trendingTVRightArrow.onclick = () => scrollCarousel(trendingTVCarousel, 'right');
        }

        // Keyboard navigation for carousels
        trendingMoviesCarousel.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                e.preventDefault();
                scrollCarousel(trendingMoviesCarousel, 'left');
            } else if (e.key === 'ArrowRight') {
                e.preventDefault();
                scrollCarousel(trendingMoviesCarousel, 'right');
            }
        });
        trendingTVCarousel.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                e.preventDefault();
                scrollCarousel(trendingTVCarousel, 'left');
            } else if (e.key === 'ArrowRight') {
                e.preventDefault();
                scrollCarousel(trendingTVCarousel, 'right');
            }
        });

        // Touch/swipe navigation for carousels
        let trendingMoviesTouchStartX = null;
        trendingMoviesCarousel.addEventListener('touchstart', (e) => {
            trendingMoviesTouchStartX = e.touches[0].clientX;
        });
        trendingMoviesCarousel.addEventListener('touchend', (e) => {
            if (trendingMoviesTouchStartX === null) return;
            const dx = e.changedTouches[0].clientX - trendingMoviesTouchStartX;
            if (Math.abs(dx) > 50) {
                if (dx > 0) scrollCarousel(trendingMoviesCarousel, 'left');
                else scrollCarousel(trendingMoviesCarousel, 'right');
            }
            trendingMoviesTouchStartX = null;
        });

        let trendingTVTouchStartX = null;
        trendingTVCarousel.addEventListener('touchstart', (e) => {
            trendingTVTouchStartX = e.touches[0].clientX;
        });
        trendingTVCarousel.addEventListener('touchend', (e) => {
            if (trendingTVTouchStartX === null) return;
            const dx = e.changedTouches[0].clientX - trendingTVTouchStartX;
            if (Math.abs(dx) > 50) {
                if (dx > 0) scrollCarousel(trendingTVCarousel, 'left');
                else scrollCarousel(trendingTVCarousel, 'right');
            }
            trendingTVTouchStartX = null;
        });

        // Auto-scroll for carousels (pause on hover)
        let trendingMoviesScrollInterval = null;
        let trendingTVScrollInterval = null;

        function startAutoScroll(carousel, interval) {
            if (interval) clearInterval(interval);
            interval = setInterval(() => {
                scrollCarousel(carousel, 'right');
            }, 5000); // Scroll every 5 seconds
        }

        function stopAutoScroll(interval) {
            if (interval) clearInterval(interval);
        }

        trendingMoviesCarousel.addEventListener('mouseenter', () => stopAutoScroll(trendingMoviesScrollInterval));
        trendingMoviesCarousel.addEventListener('mouseleave', () => startAutoScroll(trendingMoviesCarousel, trendingMoviesScrollInterval));
        trendingTVCarousel.addEventListener('mouseenter', () => stopAutoScroll(trendingTVScrollInterval));
        trendingTVCarousel.addEventListener('mouseleave', () => startAutoScroll(trendingTVCarousel, trendingTVScrollInterval));

        // Initial auto-scroll on load
        startAutoScroll(trendingMoviesCarousel, trendingMoviesScrollInterval);
        startAutoScroll(trendingTVCarousel, trendingTVScrollInterval);

        // Add focus states for accessibility
        document.querySelectorAll('.carousel-card').forEach(card => {
            card.addEventListener('focus', () => card.classList.add('focused'));
            card.addEventListener('blur', () => card.classList.remove('focused'));
        });

        // Add momentum scrolling for smoother scrolling on touch devices
        trendingMoviesCarousel.addEventListener('touchmove', (e) => {
            e.preventDefault();
            trendingMoviesCarousel.scrollBy({
                left: e.deltaX,
                behavior: 'auto'
            });
        });
        trendingTVCarousel.addEventListener('touchmove', (e) => {
            e.preventDefault();
            trendingTVCarousel.scrollBy({
                left: e.deltaX,
                behavior: 'auto'
            });
        });
        
        // === ENHANCED RESPONSIVE SIDEBAR MENU SYSTEM ===
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        const closeMenuBtn = document.getElementById('closeMenuBtn');
        const menuTime = document.getElementById('menu-time');

        // Debug: Check if elements exist
        console.log('Mobile menu elements check:');
        console.log('- mobileMenuBtn:', mobileMenuBtn);
        console.log('- mobileMenu:', mobileMenu);
        console.log('- closeMenuBtn:', closeMenuBtn);
        console.log('- menuTime:', menuTime);

        // Menu state management
        let isMenuOpen = false;
        let menuAnimationTimeout;

        // Enhanced time update with animation
        function updateMenuTime() {
            if (menuTime) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: true 
                });
                
                // Add fade animation
                menuTime.style.opacity = '0';
                setTimeout(() => {
                    menuTime.textContent = timeString;
                    menuTime.style.opacity = '1';
                }, 150);
            }
        }

        // Initial time update
        updateMenuTime();
        // Update time every minute
        setInterval(updateMenuTime, 60000);

        // Enhanced menu toggle with animations
        function toggleMenu() {
            console.log('Toggle menu called, isMenuOpen:', isMenuOpen);
            if (isMenuOpen) {
                closeMenu();
            } else {
                openMenu();
            }
        }

        // Enhanced open menu with animations
        function openMenu() {
            console.log('Opening menu...');
            if (isMenuOpen) return;
            
            isMenuOpen = true;
            document.body.classList.add('menu-open');
            document.body.style.overflow = 'hidden';
            
            // Animate hamburger to X
            mobileMenuBtn.innerHTML = '<i class="fas fa-times"></i>';
            mobileMenuBtn.style.transform = 'rotate(180deg)';
            
            // Add haptic feedback if available
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
            
            // Add focus trap for accessibility
            trapFocus(mobileMenu);
            console.log('Menu opened successfully');
        }

        // Enhanced close menu with animations
        function closeMenu() {
            console.log('Closing menu...');
            if (!isMenuOpen) return;
            
            isMenuOpen = false;
            document.body.classList.remove('menu-open');
            document.body.style.overflow = '';
            
            // Animate X back to hamburger
            mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
            mobileMenuBtn.style.transform = 'rotate(0deg)';
            
            // Remove focus trap
            removeFocusTrap();
            
            // Clear any pending animations
            if (menuAnimationTimeout) {
                clearTimeout(menuAnimationTimeout);
            }
            console.log('Menu closed successfully');
        }

        // Focus trap for accessibility
        let handleTabKey; // Declare in outer scope

        function trapFocus(element) {
            const focusableElements = element.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];

            // Define handleTabKey in outer scope
            handleTabKey = function(e) {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstElement) {
                            e.preventDefault();
                            lastElement.focus();
                        }
                    } else {
                        if (document.activeElement === lastElement) {
                            e.preventDefault();
                            firstElement.focus();
                        }
                    }
                }
            };

            element.addEventListener('keydown', handleTabKey);
        }

        function removeFocusTrap() {
            if (mobileMenu && handleTabKey) {
                mobileMenu.removeEventListener('keydown', handleTabKey);
            }
        }

        // Enhanced mobile menu button interactions
        if (mobileMenuBtn) {
            console.log('Mobile menu button found and initialized');
            
            // Touch events for better mobile response
            mobileMenuBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                mobileMenuBtn.style.transform = 'scale(0.95)';
            }, { passive: false });

            mobileMenuBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                mobileMenuBtn.style.transform = '';
                toggleMenu();
            }, { passive: false });

            // Mouse events for desktop
            mobileMenuBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                console.log('Mobile menu button clicked');
                toggleMenu();
            });
        } else {
            console.error('Mobile menu button not found!');
        }

        // Enhanced close menu button
        if (closeMenuBtn) {
            closeMenuBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                
                if (navigator.vibrate) {
                    navigator.vibrate(30);
                }
                
                closeMenu();
            });
        }

        // Close menu on backdrop click
        if (mobileMenu) {
            mobileMenu.addEventListener('click', (e) => {
                if (e.target === mobileMenu) {
                    closeMenu();
                }
            });
        }

        // Close menu when clicking on backdrop overlay
        document.addEventListener('click', (e) => {
            if (isMenuOpen && 
                !mobileMenu.contains(e.target) && 
                !mobileMenuBtn.contains(e.target)) {
                closeMenu();
            }
        });

        // Enhanced menu item interactions
        document.querySelectorAll('.menu-item').forEach(item => {
            let touchStartTime = 0;
            let touchStartY = 0;

            // Touch events for better mobile response
            item.addEventListener('touchstart', (e) => {
                touchStartTime = Date.now();
                touchStartY = e.touches[0].clientY;
                item.style.transform = 'translateX(8px) scale(0.98)';
                item.style.transition = 'transform 0.1s ease';
            }, { passive: false });

            item.addEventListener('touchmove', (e) => {
                const touchY = e.touches[0].clientY;
                const deltaY = Math.abs(touchY - touchStartY);
                
                if (deltaY > 10) {
                    item.style.transform = '';
                }
            }, { passive: false });

            item.addEventListener('touchend', (e) => {
                const touchEndTime = Date.now();
                const touchDuration = touchEndTime - touchStartTime;
                
                item.style.transform = '';
                item.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                
                if (touchDuration < 300) {
                    e.preventDefault();
                    navigateToSection(item);
                }
            }, { passive: false });

            // Mouse events for desktop
            item.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                navigateToSection(item);
            });

            // Hover effects for desktop
            item.addEventListener('mouseenter', () => {
                if (!isMenuOpen) return;
                item.style.transform = 'translateX(8px)';
            });

            item.addEventListener('mouseleave', () => {
                if (!isMenuOpen) return;
                item.style.transform = '';
            });
        });

        // Enhanced navigation function
        function navigateToSection(menuItem) {
            const targetId = menuItem.getAttribute('href');
            const target = document.querySelector(targetId);
            
            // Add haptic feedback
            if (navigator.vibrate) {
                navigator.vibrate(20);
            }
            
            // Close menu immediately for better UX
            closeMenu();
            
            if (target) {
                // Add a small delay to allow menu to close first
                menuAnimationTimeout = setTimeout(() => {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 300);
            }
        }

        // Enhanced window resize handler
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (window.innerWidth > 600) {
                    closeMenu();
                }
            }, 150);
        });

        // Enhanced keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (isMenuOpen) {
                if (e.key === 'Escape') {
                    closeMenu();
                } else if (e.key === 'Tab') {
                    // Let the focus trap handle Tab navigation
                    return;
                }
            }
        });

        // Keyboard navigation for menu
        document.addEventListener('keydown', (e) => {
            if (document.body.classList.contains('menu-open')) {
                if (e.key === 'Escape') {
                    closeMenu();
                }
            }
        });

        // Update menu item text on language change
        function updateMenuLanguage() {
            const currentLang = document.body.getAttribute('data-lang') || 'en';
            document.querySelectorAll('.menu-item span').forEach(span => {
                const attr = `data-${currentLang}`;
                if (span.hasAttribute(attr)) {
                    span.textContent = span.getAttribute(attr);
                }
            });
        }

        // Call on language change
        if (langToggle) {
            langToggle.addEventListener('click', updateMenuLanguage);
        }
        
        // Initial call
        updateMenuLanguage();

    </script>
</body>
</html>